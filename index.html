<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Quantum ON Demand JoBs - Multi-role Login & Dashboard with Icons</title>

<link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
/>

<style>
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        margin: 0; padding: 0; background: #f4f7fc; color: #333;
    }
    header {
        background: #004aad; color: white;
        padding: 1rem 2rem; text-align: center; font-size: 1.8rem; font-weight: bold;
        letter-spacing: 1.2px;
    }
    main {
        max-width: 900px; margin: 2rem auto; padding: 0 1rem;
    }
    h2 { color: #004aad; margin-bottom: 1rem; }
    section {
        background: white; border-radius: 8px;
        box-shadow: 0 2px 10px rgb(0 0 0 / 0.12);
        margin-bottom: 2rem; padding: 2rem 1.5rem;
        transition: all 0.3s ease;
    }
    label {
        display: block; margin-bottom: 0.3rem; font-weight: 600;
    }
    input, button, select { /* Added select for consistency */
        width: 100%; padding: 0.55rem; margin-bottom: 1rem;
        border: 1px solid #ccc; border-radius: 5px; font-size: 1rem;
        box-sizing: border-box;
    }
    button {
        background: #004aad; color: white; border: none; cursor: pointer;
        font-weight: 700; transition: background 0.3s ease;
        display: flex; align-items: center; justify-content: center; gap: 0.6rem;
    }
    button:hover { background: #00337f; }
    nav {
        display: flex; justify-content: center; gap: 1rem; margin-bottom: 2rem;
    }
    nav button {
        width: auto; padding: 0.5rem 1.2rem;
        font-weight: 600; display: flex; align-items: center; gap: 0.5rem;
        border-radius: 6px; border: 2px solid transparent;
        background: #e1e9ff; color: #004aad;
        transition: background 0.3s ease, border-color 0.3s ease;
    }
    nav button.active {
        background: #00337f; color: white; border-color: #001f4d;
    }
    .hidden { display: none; }
    .dashboard-section button {
        width: auto; margin-right: 1rem; margin-bottom: 1rem;
        font-weight: 600;
        display: inline-flex; align-items: center; gap: 0.5rem;
        border-radius: 6px;
    }
    .logout-btn {
        background: #c82333 !important;
    }
    .logout-btn:hover {
        background: #a71d2a !important;
    }
    table {
        width: 100%; border-collapse: collapse; margin-bottom: 1rem;
        margin-top: 1.5rem; /* Added for spacing above tables */
        font-size: 0.9em; /* Make font slightly smaller for more columns */
    }
    th, td {
        border: 1px solid #ddd; padding: 8px; text-align: left;
        vertical-align: top; /* Align content to top for multi-line */
    }
    th {
        background-color: #004aad; color: white;
    }
    .applicant-count {
        color: #004aad;
        font-weight: bold;
        cursor: pointer;
        text-decoration: underline;
    }
    .applicant-count:hover {
        color: #00337f;
    }
    /* Styles for forms with multiple buttons at the bottom */
    .form-buttons {
        display: flex;
        gap: 1rem;
        margin-top: 1rem;
    }
    .form-buttons button {
        width: auto;
        flex-grow: 1; /* Make buttons take equal width */
    }
    .form-buttons .cancel-btn {
        background: #6c757d; /* Grey for cancel */
    }
    .form-buttons .cancel-btn:hover {
        background: #5a6268;
    }

    /* Specific styles for attendance */
    .attendance-form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
    }
    .attendance-form-row div {
        margin-bottom: 1rem;
    }
    .attendance-form-row label {
        margin-bottom: 0.3rem;
    }
    .attendance-form-row input {
        margin-bottom: 0; /* Remove default input margin */
    }

    /* Dashboard specific styling for nav buttons */
    #dashboard-candidate .dashboard-nav-buttons,
    #dashboard-admin .dashboard-nav-buttons,
    #dashboard-sales .dashboard-nav-buttons,
    #dashboard-finance .dashboard-nav-buttons {
        display: flex;
        flex-wrap: wrap; /* Allow wrapping on smaller screens */
        gap: 1rem;
        margin-bottom: 1.5rem;
        justify-content: center; /* Center the buttons */
    }
    #dashboard-candidate .dashboard-nav-buttons button,
    #dashboard-admin .dashboard-nav-buttons button,
    #dashboard-sales .dashboard-nav-buttons button,
    #dashboard-finance .dashboard-nav-buttons button {
        width: auto;
        flex-grow: 1;
        min-width: 150px; /* Ensure buttons don't get too small */
        background: #e1e9ff;
        color: #004aad;
        border: 2px solid #004aad;
    }
    #dashboard-candidate .dashboard-nav-buttons button:hover,
    #dashboard-admin .dashboard-nav-buttons button:hover,
    #dashboard-sales .dashboard-nav-buttons button:hover,
    #dashboard-finance .dashboard-nav-buttons button:hover {
        background: #004aad;
        color: white;
    }
    /* Dashboard currently displayed tab */
    #dashboard-candidate .dashboard-nav-buttons button.active,
    #dashboard-admin .dashboard-nav-buttons button.active,
    #dashboard-sales .dashboard-nav-buttons button.active,
    #dashboard-finance .dashboard-nav-buttons button.active {
        background: #00337f;
        color: white;
        border-color: #001f4d;
    }

    /* Ensure main table in candidate dashboard gets proper styling */
    #dashboard-candidate table,
    #dashboard-admin table,
    #dashboard-sales table,
    #dashboard-finance table {
        margin-top: 1rem; /* Adjust spacing below main nav buttons */
    }
    #candidate-attendance-form-container {
        margin-bottom: 2rem;
        padding-bottom: 1rem;
        border-bottom: 1px solid #eee;
    }
    /* Specific styling for edit button in table */
    .edit-btn {
        background: #28a745; /* Green for edit */
        padding: 5px 10px;
        margin-bottom: 0;
        width: fit-content;
    }
    .edit-btn:hover {
        background: #218838;
    }
    /* Styling for action buttons within tables (finance view) */
    .action-btn-finance {
        background: #004aad;
        color: white;
        border: none;
        padding: 5px 10px;
        border-radius: 4px;
        cursor: pointer;
        font-weight: normal;
        font-size: 0.85em;
        margin-right: 5px;
        display: inline-flex;
        align-items: center;
        gap: 5px;
        width: auto;
    }
    .action-btn-finance:hover {
        background: #00337f;
    }
    .action-btn-finance.red {
        background: #c82333;
    }
    .action-btn-finance.red:hover {
        background: #a71d2a;
    }
    .action-btn-finance.green {
        background: #28a745;
    }
    .action-btn-finance.green:hover {
        background: #218838;
    }

</style>
</head>
<body>

<header>Quantum ON Demand JoBs</header>

<main>

    <nav id="nav-login-tabs">
        <button id="tab-hr" data-target="login-hr">
            <i class="fa-solid fa-user-tie"></i> HR Login
        </button>
        <button id="tab-candidate" data-target="login-candidate">
            <i class="fa-solid fa-user"></i> Candidate Login
        </button>
        <button id="tab-admin" data-target="login-admin">
            <i class="fa-solid fa-shield-halved"></i> Admin Login
        </button>
        <button id="tab-sales" data-target="login-sales">
            <i class="fa-solid fa-handshake"></i> Sales Login
        </button>
        <button id="tab-finance" data-target="login-finance">
            <i class="fa-solid fa-coins"></i> Finance Login
        </button>
    </nav>

    <section id="login-hr" class="">
        <h2><i class="fa-solid fa-user-tie"></i> HR Login</h2>
        <form id="form-hr-login" data-role="hr">
            <label for="hr-email">Email</label>
            <input type="email" id="hr-email" required placeholder="hr@example.com" value="hr@example.com" />
            <label for="hr-password">Password</label>
            <input type="password" id="hr-password" required placeholder="Password" value="hr123" />
            <button type="submit"><i class="fa-solid fa-right-to-bracket"></i> Login</button>
        </form>
    </section>

    <section id="login-candidate" class="hidden">
        <h2><i class="fa-solid fa-user"></i> Candidate Login</h2>
        <form id="form-candidate-login" data-role="candidate">
            <label for="cand-phone-login">Phone Number</label>
            <input type="tel" id="cand-phone-login" required placeholder="9876543210" value="9876543210" />
            <label for="cand-password-login">Password</label>
            <input type="password" id="cand-password-login" required placeholder="Password" value="cand123" />
            <button type="submit"><i class="fa-solid fa-right-to-bracket"></i> Login</button>
        </form>
    </section>

    <section id="login-admin" class="hidden">
        <h2><i class="fa-solid fa-shield-halved"></i> Admin Login</h2>
        <form id="form-admin-login" data-role="admin">
            <label for="admin-email">Email</label>
            <input type="email" id="admin-email" required placeholder="admin@example.com" value="admin@example.com" />
            <label for="admin-password">Password</label>
            <input type="password" id="admin-password" required placeholder="Password" value="admin123" />
            <button type="submit"><i class="fa-solid fa-right-to-bracket"></i> Login</button>
        </form>
    </section>

    <section id="login-sales" class="hidden">
        <h2><i class="fa-solid fa-handshake"></i> Sales Login</h2>
        <form id="form-sales-login" data-role="sales">
            <label for="sales-email">Email</label>
            <input type="email" id="sales-email" required placeholder="sales@example.com" value="sales@example.com" />
            <label for="sales-password">Password</label>
            <input type="password" id="sales-password" required placeholder="Password" value="sales123" />
            <button type="submit"><i class="fa-solid fa-right-to-bracket"></i> Login</button>
        </form>
    </section>

    <section id="login-finance" class="hidden">
        <h2><i class="fa-solid fa-coins"></i> Finance Login</h2>
        <form id="form-finance-login" data-role="finance">
            <label for="finance-email">Email</label>
            <input type="email" id="finance-email" required placeholder="finance@example.com" value="finance@example.com" />
            <label for="finance-password">Password</label>
            <input type="password" id="finance-password" required placeholder="Password" value="finance123" />
            <button type="submit"><i class="fa-solid fa-right-to-bracket"></i> Login</button>
        </form>
    </section>

    <section id="dashboard-hr" class="dashboard-section hidden">
        <h2><i class="fa-solid fa-user-tie"></i> HR Dashboard</h2>
        <button id="post-job-btn"><i class="fa-solid fa-pen-to-square"></i> Post New Job</button>
        <button id="manage-slots-btn"><i class="fa-solid fa-clock"></i> Manage Slots & Assignments</button>
        <button id="view-invoices-btn"><i class="fa-solid fa-file-invoice-dollar"></i> Invoices & Payments</button>
        <button id="manage-attendance-btn"><i class="fa-solid fa-user-check"></i> Manage Attendance & Invoicing</button>

        <h3>Recent Job Postings</h3>
        <table id="job-postings-table">
            <thead>
                <tr>
                    <th>Job ID</th> <th>Job Title</th>
                    <th>Status</th>
                    <th>Applicants</th>
                    <th>Slot Time</th>
                    <th>Work Area</th>
                    <th>Location</th>
                    <th>Salary (Rs.)</th>
                    <th>Posted On</th>
                    <th>Client</th>
                </tr>
            </thead>
            <tbody>
                <tr data-job-role="Quantum Software Engineer" data-job-id="JOB-QSE-001">
                    <td>JOB-QSE-001</td>
                    <td>Quantum Software Engineer</td>
                    <td>Active</td>
                    <td><span class="applicant-count" data-job-role="Quantum Software Engineer" data-job-id="JOB-QSE-001">15</span></td>
                    <td>9:00 AM - 5:00 PM</td>
                    <td>Hitech City</td>
                    <td>Hyderabad, Telangana</td>
                    <td>95000</td>
                    <td>2025-07-10</td>
                    <td>GlobalTech Solutions</td>
                </tr>
                <tr data-job-role="AI/ML Specialist" data-job-id="JOB-AIML-002">
                    <td>JOB-AIML-002</td>
                    <td>AI/ML Specialist</td>
                    <td>Active</td>
                    <td><span class="applicant-count" data-job-role="AI/ML Specialist" data-job-id="JOB-AIML-002">22</span></td>
                    <td>10:00 AM - 6:00 PM</td>
                    <td>Electronic City</td>
                    <td>Bengaluru, Karnataka</td>
                    <td>80000</td>
                    <td>2025-07-05</td>
                    <td>Innovate Corp</td>
                </tr>
                <tr data-job-role="Frontend Developer (React)" data-job-id="JOB-FDR-003">
                    <td>JOB-FDR-003</td>
                    <td>Frontend Developer (React)</td>
                    <td>Closed</td>
                    <td><span class="applicant-count" data-job-role="Frontend Developer (React)" data-job-id="JOB-FDR-003">30</span></td>
                    <td>9:30 AM - 5:30 PM</td>
                    <td>Guindy</td>
                    <td>Chennai, Tamil Nadu</td>
                    <td>60000</td>
                    <td>2025-06-20</td>
                    <td>FutureNet Services</td>
                </tr>
            </tbody>
        </table>

        <button class="logout-btn"><i class="fa-solid fa-right-from-bracket"></i> Logout</button>
    </section>

    <section id="hr-post-job" class="hidden">
        <h2><i class="fa-solid fa-pen-to-square"></i> Post New Job</h2>
        <form id="form-post-job">
            <label for="job-role">Job Role Title</label>
            <input type="text" id="job-role" required placeholder="e.g., Data Analyst" />

            <label for="slot-time-start">Slot Time Start</label>
            <input type="time" id="slot-time-start" required />

            <label for="slot-time-end">Slot Time End</label>
            <input type="time" id="slot-time-end" required />

            <label for="work-area">Work Area</label>
            <input type="text" id="work-area" required placeholder="e.g., Chennai IT Park" />

            <label for="city">City</label>
            <input type="text" id="city" required placeholder="e.g., Chennai" />

            <label for="state">State</label>
            <input type="text" id="state" required placeholder="e.g., Tamil Nadu" />

            <label for="salary">Salary (Rs.)</label>
            <input type="number" id="salary" required placeholder="e.g., 30000" min="0" />

            <label for="job-client-id">Client Company</label>
            <select id="job-client-id" required>
                <option value="">-- Select Client --</option>
                </select>

            <div class="form-buttons">
                <button type="submit"><i class="fa-solid fa-paper-plane"></i> Post Job</button>
                <button type="button" class="cancel-btn" id="cancel-post-job"><i class="fa-solid fa-xmark"></i> Cancel</button>
            </div>
        </form>
    </section>

    <section id="hr-applicants-list" class="hidden">
        <h2 id="applicants-list-title"><i class="fa-solid fa-users"></i> Applicants for [Job Title]</h2>
        <table>
            <thead>
                <tr>
                    <th>Applicant Name</th>
                    <th>Contact</th>
                    <th>Applied On</th>
                    <th>Status</th>
                    <th>Resume</th>
                </tr>
            </thead>
            <tbody id="applicants-detail-body">
                </tbody>
        </table>
        <button id="back-to-hr-dashboard-from-applicants" class="cancel-btn"><i class="fa-solid fa-arrow-left"></i> Back to Dashboard</button>
    </section>

    <section id="hr-slots-assignments" class="hidden">
        <h2><i class="fa-solid fa-clock"></i> Manage Slots & Assignments</h2>
        <table>
            <thead>
                <tr>
                    <th>Job Role</th>
                    <th>Candidate</th>
                    <th>Date</th>
                    <th>Time Slot</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody id="slots-assignments-body">
                </tbody>
        </table>
        <button id="back-to-hr-dashboard-from-slots" class="cancel-btn"><i class="fa-solid fa-arrow-left"></i> Back to Dashboard</button>
    </section>

    <section id="hr-invoices-payments" class="hidden">
        <h2><i class="fa-solid fa-file-invoice-dollar"></i> Invoices & Payments</h2>
        <table>
            <thead>
                <tr>
                    <th>Invoice ID</th>
                    <th>Client/Worker</th>
                    <th>Amount (Rs.)</th>
                    <th>Date</th>
                    <th>Due Date</th>
                    <th>Status</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody id="invoices-payments-body">
                </tbody>
        </table>
        <button id="back-to-hr-dashboard-from-invoices" class="cancel-btn"><i class="fa-solid fa-arrow-left"></i> Back to Dashboard</button>
    </section>

    <section id="hr-attendance-invoicing" class="hidden">
        <h2><i class="fa-solid fa-user-check"></i> Manage Attendance & Invoicing</h2>

        <h3>Mark Attendance Manually (HR)</h3>
        <form id="form-mark-attendance">
            <label for="worker-name">Worker Name</label>
            <input type="text" id="worker-name" required placeholder="e.g., John Doe" />

            <label for="job-id-for-attendance">Job ID</label> <input type="text" id="job-id-for-attendance" required placeholder="e.g., JOB-DE-001" />

            <label for="attendance-date">Date</label>
            <input type="date" id="attendance-date" required />

            <div class="attendance-form-row">
                <div>
                    <label for="check-in-time">Check-in Time</label>
                    <input type="time" id="check-in-time" />
                </div>
                <div>
                    <label for="check-out-time">Check-out Time</label>
                    <input type="time" id="check-out-time" />
                </div>
            </div>

            <div class="form-buttons">
                <button type="button" id="mark-check-in-btn"><i class="fa-solid fa-arrow-right-to-bracket"></i> Check-in</button>
                <button type="button" id="mark-check-out-btn"><i class="fa-solid fa-arrow-right-from-bracket"></i> Check-out</button>
            </div>
        </form>

        <hr style="margin: 2rem 0; border-color: #eee;">

        <h3>Recent Attendance Records</h3>
        <table style="width: 100%;">
            <thead>
                <tr>
                    <th>Worker</th>
                    <th>Job ID</th> <th>Date</th>
                    <th>Check-in</th>
                    <th>Check-out</th>
                    <th>Work ID</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody id="attendance-records-body">
                </tbody>
        </table>

        <button id="generate-invoice-btn"><i class="fa-solid fa-file-invoice"></i> Generate Invoice for Selected</button>
        <button id="back-to-hr-dashboard-from-attendance" class="cancel-btn" style="margin-top: 1rem;"><i class="fa-solid fa-arrow-left"></i> Back to Dashboard</button>
    </section>


    <section id="dashboard-candidate" class="hidden dashboard-section">
        <h2><i class="fa-solid fa-user"></i> Candidate Dashboard</h2>

        <div class="dashboard-nav-buttons">
            <button id="view-available-jobs-cand-btn"><i class="fa-solid fa-briefcase"></i> View & Apply Jobs</button>
            <button id="my-applications-cand-btn"><i class="fa-solid fa-list-check"></i> My Applications</button>
            <button id="payment-history-cand-btn"><i class="fa-solid fa-credit-card"></i> Payment History</button>
        </div>

        <div id="candidate-attendance-form-container">
            <h3>Mark My Attendance</h3>
            <form id="form-candidate-attendance">
                <label for="candidate-job-id">Job ID</label> <input type="text" id="candidate-job-id" required placeholder="e.g., JOB-DE-001" />

                <label for="candidate-attendance-date">Date</label>
                <input type="date" id="candidate-attendance-date" required />

                <div class="attendance-form-row">
                    <div>
                        <label for="candidate-check-in-time">Check-in Time</label>
                        <input type="time" id="candidate-check-in-time" />
                    </div>
                    <div>
                        <label for="candidate-check-out-time">Check-out Time</label>
                        <input type="time" id="candidate-check-out-time" />
                    </div>
                </div>

                <div class="form-buttons">
                    <button type="button" id="candidate-mark-check-in-btn"><i class="fa-solid fa-arrow-right-to-bracket"></i> Check-in</button>
                    <button type="button" id="candidate-mark-check-out-btn"><i class="fa-solid fa-arrow-right-from-bracket"></i> Check-out</button>
                </div>
            </form>
        </div>


        <hr style="margin: 2rem 0; border-color: #eee;">

        <h3>My Attendance & Work IDs</h3>
        <table>
            <thead>
                <tr>
                    <th>Job ID</th> <th>Date</th>
                    <th>Check-in</th>
                    <th>Check-out</th>
                    <th>Work ID</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody id="candidate-attendance-body">
                </tbody>
        </table>

        <button class="logout-btn"><i class="fa-solid fa-right-from-bracket"></i> Logout</button>
    </section>

    <section id="candidate-available-slots" class="hidden">
        <h2><i class="fa-solid fa-briefcase"></i> Available Job Slots</h2>
        <table>
            <thead>
                <tr>
                    <th>Job ID</th> <th>Job Role</th>
                    <th>Work Area</th>
                    <th>City</th>
                    <th>State</th>
                    <th>Slot Time</th>
                    <th>Hours</th>
                    <th>Amount (Rs.)</th>
                    <th>Action</th> </tr>
            </thead>
            <tbody id="available-slots-body">
                </tbody>
        </table>
        <button id="back-to-candidate-dashboard-from-available-slots" class="cancel-btn"><i class="fa-solid fa-arrow-left"></i> Back to Dashboard</button>
    </section>

    <section id="candidate-my-applications" class="hidden">
        <h2><i class="fa-solid fa-list-check"></i> My Applications</h2>
        <table>
            <thead>
                <tr>
                    <th>Job ID</th> <th>Job Title</th>
                    <th>Work Area</th>
                    <th>City</th>
                    <th>State</th>
                    <th>Slot Time</th>
                    <th>Hours</th>
                    <th>Application Status</th>
                    <th>Applied On</th>
                </tr>
            </thead>
            <tbody id="my-applications-body">
                </tbody>
        </table>
        <button id="back-to-candidate-dashboard-from-applications" class="cancel-btn"><i class="fa-solid fa-arrow-left"></i> Back to Dashboard</button>
    </section>

    <section id="candidate-payment-history" class="hidden">
        <h2><i class="fa-solid fa-credit-card"></i> Payment History</h2>
        <table>
            <thead>
                <tr>
                    <th>Work ID</th>
                    <th>Job ID</th> <th>Job Role</th>
                    <th>Date</th>
                    <th>Amount (Rs.)</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody id="candidate-payment-history-body">
                </tbody>
        </table>
        <button id="back-to-candidate-dashboard-from-payment-history" class="cancel-btn"><i class="fa-solid fa-arrow-left"></i> Back to Dashboard</button>
    </section>


    <section id="dashboard-admin" class="hidden dashboard-section">
        <h2><i class="fa-solid fa-shield-halved"></i> Admin Dashboard</h2>
        <div class="dashboard-nav-buttons">
            <button id="admin-manage-users-btn"><i class="fa-solid fa-users-cog"></i> Manage Users</button>
            <button id="admin-add-user-btn"><i class="fa-solid fa-user-plus"></i> Add New User</button>
            <button id="admin-audit-logs-btn"><i class="fa-solid fa-file-alt"></i> Audit Logs</button>
            <button id="admin-hr-overview-btn"><i class="fa-solid fa-user-tie"></i> HR Overview</button>
            <button id="admin-candidate-overview-btn"><i class="fa-solid fa-user"></i> Candidate Overview</button>
            <button id="admin-sales-overview-btn"><i class="fa-solid fa-handshake"></i> Sales Overview</button>
            <button id="admin-finance-overview-btn"><i class="fa-solid fa-coins"></i> Finance Overview</button>
        </div>

        <h3>System Activity Log</h3>
        <table id="admin-system-activity-table">
            <thead>
                <tr>
                    <th>Timestamp</th>
                    <th>User</th>
                    <th>Action</th>
                    <th>Details</th>
                </tr>
            </thead>
            <tbody>
                </tbody>
        </table>

        <button class="logout-btn"><i class="fa-solid fa-right-from-bracket"></i> Logout</button>
    </section>

    <section id="admin-add-user" class="hidden">
        <h2><i class="fa-solid fa-user-plus"></i> Add New User</h2>
        <form id="form-add-user">
            <label for="new-username">Username (Email or Phone)</label>
            <input type="text" id="new-username" required placeholder="e.g., new.user@example.com or 9988776655" />

            <label for="new-password">Password</label>
            <input type="password" id="new-password" required placeholder="Choose a password" />

            <label for="new-user-role">Role</label>
            <select id="new-user-role" required>
                <option value="">-- Select Role --</option>
                <option value="HR">HR</option>
                <option value="Candidate">Candidate</option>
                <option value="Admin">Admin</option>
                <option value="Sales">Sales</option>
                <option value="Finance">Finance</option>
            </select>

            <div class="form-buttons">
                <button type="submit"><i class="fa-solid fa-user-plus"></i> Add User</button>
                <button type="button" class="cancel-btn" id="cancel-add-user"><i class="fa-solid fa-xmark"></i> Cancel</button>
            </div>
        </form>
    </section>
    <section id="admin-manage-users" class="hidden">
        <h2><i class="fa-solid fa-users-cog"></i> Manage Users</h2>
        <table>
            <thead>
                <tr>
                    <th>User ID</th>
                    <th>Username</th>
                    <th>Role</th>
                    <th>Last Login</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="admin-users-body">
                </tbody>
        </table>
        <button id="back-to-admin-dashboard-from-users" class="cancel-btn"><i class="fa-solid fa-arrow-left"></i> Back to Dashboard</button>
    </section>

    <section id="admin-audit-logs" class="hidden">
        <h2><i class="fa-solid fa-file-alt"></i> Audit Logs</h2>
        <table>
            <thead>
                <tr>
                    <th>Timestamp</th>
                    <th>User</th>
                    <th>Action</th>
                    <th>Details</th>
                </tr>
            </thead>
            <tbody id="admin-audit-logs-body">
                </tbody>
        </table>
        <button id="back-to-admin-dashboard-from-audit-logs" class="cancel-btn"><i class="fa-solid fa-arrow-left"></i> Back to Dashboard</button>
    </section>

    <section id="admin-hr-overview" class="hidden">
        <h2><i class="fa-solid fa-user-tie"></i> HR Overview</h2>
        <h3>Job Posting Summary</h3>
        <table>
            <thead>
                <tr>
                    <th>Category</th>
                    <th>Count</th>
                </tr>
            </thead>
            <tbody id="admin-hr-jobs-summary-body"></tbody>
        </table>

        <h3>Applicant Summary</h3>
        <table>
            <thead>
                <tr>
                    <th>Status</th>
                    <th>Count</th>
                </tr>
            </thead>
            <tbody id="admin-hr-applicants-summary-body"></tbody>
        </table>
        <button id="back-to-admin-dashboard-from-hr-overview" class="cancel-btn"><i class="fa-solid fa-arrow-left"></i> Back to Dashboard</button>
    </section>

    <section id="admin-candidate-overview" class="hidden">
        <h2><i class="fa-solid fa-user"></i> Candidate Overview</h2>
        <h3>Candidate Status Summary</h3>
        <table>
            <thead>
                <tr>
                    <th>Status</th>
                    <th>Count</th>
                </tr>
            </thead>
            <tbody id="admin-candidate-status-body"></tbody>
        </table>

        <h3>Application Status Breakdown</h3>
        <table>
            <thead>
                <tr>
                    <th>Status</th>
                    <th>Count</th>
                </tr>
            </thead>
            <tbody id="admin-candidate-applications-body"></tbody>
        </table>

        <h3>Attendance & Work Summary</h3>
        <table>
            <thead>
                <tr>
                    <th>Category</th>
                    <th>Count / Hours</th>
                </tr>
            </thead>
            <tbody id="admin-candidate-attendance-body"></tbody>
        </table>
        <button id="back-to-admin-dashboard-from-candidate-overview" class="cancel-btn"><i class="fa-solid fa-arrow-left"></i> Back to Dashboard</button>
    </section>

    <section id="admin-sales-overview" class="hidden">
        <h2><i class="fa-solid fa-handshake"></i> Sales Overview</h2>
        <h3>Client & Contract Summary</h3>
        <table>
            <thead>
                <tr>
                    <th>Category</th>
                    <th>Value / Count</th>
                </tr>
            </thead>
            <tbody id="admin-sales-summary-body"></tbody>
        </table>
        <button id="back-to-admin-dashboard-from-sales-overview" class="cancel-btn"><i class="fa-solid fa-arrow-left"></i> Back to Dashboard</button>
    </section>

    <section id="admin-finance-overview" class="hidden">
        <h2><i class="fa-solid fa-coins"></i> Finance Overview</h2>
        <h3>Invoicing & Payments Summary</h3>
        <table>
            <thead>
                <tr>
                    <th>Category</th>
                    <th>Amount (Rs.)</th>
                </tr>
            </thead>
            <tbody id="admin-finance-summary-body"></tbody>
        </table>

        <h3>Payroll & Payouts Summary</h3>
        <table>
            <thead>
                <tr>
                    <th>Category</th>
                    <th>Amount (Rs.)</th>
                </tr>
            </thead>
            <tbody id="admin-finance-payroll-body"></tbody>
        </table>
        <button id="back-to-admin-dashboard-from-finance-overview" class="cancel-btn"><i class="fa-solid fa-arrow-left"></i> Back to Dashboard</button>
    </section>


    <section id="dashboard-sales" class="hidden dashboard-section">
        <h2><i class="fa-solid fa-handshake"></i> Sales Dashboard</h2>
        <div class="dashboard-nav-buttons">
            <button id="sales-clients-contracts-btn"><i class="fa-solid fa-building"></i> Clients & Contracts</button>
            <button id="sales-reports-btn"><i class="fa-solid fa-chart-line"></i> Sales Reports</button>
            <button id="sales-add-client-btn"><i class="fa-solid fa-handshake-angle"></i> Add New Client</button>
        </div>

        <div id="sales-clients-contracts-view">
            <h3>Active Client Contracts</h3>
            <table>
                <thead>
                    <tr>
                        <th>Client ID</th>
                        <th>Company Name</th>
                        <th>Contact Person</th>
                        <th>Contract Value (Rs.)</th>
                        <th>Renewal Date</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="sales-clients-contracts-body">
                    </tbody>
            </table>
        </div>

        <div id="sales-reports-view" class="hidden">
            <h3>Sales Reports Overview</h3>
            <table>
                <thead>
                    <tr>
                        <th>Report ID</th>
                        <th>Report Type</th>
                        <th>Date</th>
                        <th>Total Revenue (Rs.)</th>
                        <th>New Leads</th>
                        <th>Deals Closed</th>
                    </tr>
                </thead>
                <tbody id="sales-reports-body">
                    </tbody>
            </table>
        </div>

        <button class="logout-btn"><i class="fa-solid fa-right-from-bracket"></i> Logout</button>
    </section>

    <section id="sales-add-client" class="hidden">
        <h2><i class="fa-solid fa-handshake-angle"></i> Add New Client</h2>
        <form id="form-add-client">
            <label for="client-company-name">Company Name</label>
            <input type="text" id="client-company-name" required placeholder="e.g., Tech Solutions Inc." />

            <label for="client-gst-no">GST Number</label>
            <input type="text" id="client-gst-no" placeholder="e.g., 22AAAAA0000A1Z5" />

            <label for="client-company-address">Company Address</label>
            <input type="text" id="client-company-address" required placeholder="e.g., 123 Main St, Anytown, State, Pincode" />

            <label for="client-employee-strength">Employee Strength</label>
            <input type="number" id="client-employee-strength" min="1" placeholder="e.g., 100" />

            <label for="client-contact-person">Contact Person Name</label>
            <input type="text" id="client-contact-person" required placeholder="e.g., Jane Doe" />

            <label for="client-contact-email">Contact Person Email</label>
            <input type="email" id="client-contact-email" required placeholder="e.g., jane.doe@example.com" />

            <label for="client-status">Client Status</label>
            <select id="client-status" required>
                <option value="Prospect">Prospect</option>
                <option value="Active">Active</option>
                <option value="Inactive">Inactive</option>
            </select>

            <div class="form-buttons">
                <button type="submit"><i class="fa-solid fa-plus-circle"></i> Add Client</button>
                <button type="button" class="cancel-btn" id="cancel-add-client"><i class="fa-solid fa-xmark"></i> Cancel</button>
            </div>
        </form>
    </section>
    <section id="sales-edit-client" class="hidden">
        <h2><i class="fa-solid fa-edit"></i> Edit Client Details</h2>
        <form id="form-edit-client">
            <input type="hidden" id="edit-client-id" /> <label for="edit-client-company-name">Company Name</label>
            <input type="text" id="edit-client-company-name" required />

            <label for="edit-client-gst-no">GST Number</label>
            <input type="text" id="edit-client-gst-no" />

            <label for="edit-client-company-address">Company Address</label>
            <input type="text" id="edit-client-company-address" required />

            <label for="edit-client-employee-strength">Employee Strength</label>
            <input type="number" id="edit-client-employee-strength" min="1" />

            <label for="edit-client-contact-person">Contact Person Name</label>
            <input type="text" id="edit-client-contact-person" required />

            <label for="edit-client-contact-email">Contact Person Email</label>
            <input type="email" id="edit-client-contact-email" required />

            <label for="edit-client-contract-value">Contract Value (Rs.)</label>
            <input type="number" id="edit-client-contract-value" min="0" />

            <label for="edit-client-renewal-date">Renewal Date</label>
            <input type="date" id="edit-client-renewal-date" />

            <label for="edit-client-status">Client Status</label>
            <select id="edit-client-status" required>
                <option value="Prospect">Prospect</option>
                <option value="Active">Active</option>
                <option value="Inactive">Inactive</option>
            </select>

            <div class="form-buttons">
                <button type="submit"><i class="fa-solid fa-save"></i> Save Changes</button>
                <button type="button" class="cancel-btn" id="cancel-edit-client"><i class="fa-solid fa-xmark"></i> Cancel</button>
            </div>
        </form>
    </section>
    <section id="dashboard-finance" class="hidden dashboard-section">
        <h2><i class="fa-solid fa-coins"></i> Finance Dashboard</h2>
        <div class="dashboard-nav-buttons">
            <button id="finance-invoices-payments-btn"><i class="fa-solid fa-file-invoice-dollar"></i> Invoices & Payments</button>
            <button id="finance-payroll-payouts-btn"><i class="fa-solid fa-wallet"></i> Payroll & Payouts</button>
            <button id="finance-reports-btn"><i class="fa-solid fa-chart-pie"></i> Financial Reports</button>
        </div>

        <div id="finance-invoices-payments-view">
            <h3>All Invoices & Payments</h3>
            <table>
                <thead>
                    <tr>
                        <th>Invoice ID</th>
                        <th>Client/Worker</th>
                        <th>Amount (Rs.)</th>
                        <th>Date</th>
                        <th>Due Date</th>
                        <th>Status</th>
                        <th>Type</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody id="finance-invoices-payments-body">
                    </tbody>
            </table>
        </div>

        <div id="finance-payroll-payouts-view" class="hidden">
            <h3>Payroll & Worker Payouts</h3>
            <table>
                <thead>
                    <tr>
                        <th>Payout ID</th>
                        <th>Payee</th>
                        <th>Work ID</th>
                        <th>Slot Time</th>
                        <th>Company</th>
                        <th>Date</th>
                        <th>Check-in</th>
                        <th>Check-out</th>
                        <th>Amount (Rs.)</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="finance-payroll-payouts-body">
                    </tbody>
            </table>
        </div>

        <div id="finance-reports-view" class="hidden">
            <h3>Key Financial Reports</h3>
            <table>
                <thead>
                    <tr>
                        <th>Report Name</th>
                        <th>Value (Rs.)</th>
                        <th>Period</th>
                    </tr>
                </thead>
                <tbody id="finance-reports-body">
                    <tr><td>Total Revenue (YTD)</td><td>1,500,000</td><td>2025 YTD</td></tr>
                    <tr><td>Total Payouts (YTD)</td><td>800,000</td><td>2025 YTD</td></tr>
                    <tr><td>Net Profit (YTD)</td><td>700,000</td><td>2025 YTD</td></tr>
                    <tr><td>Outstanding Receivables</td><td>125,000</td><td>Current</td></tr>
                    <tr><td>Pending Worker Payments</td><td>15,000</td><td>Current</td></tr>
                </tbody>
            </table>
        </div>

        <button class="logout-btn"><i class="fa-solid fa-right-from-bracket"></i> Logout</button>
    </section>
    </main>

<script>
    // --- Global Unique ID Counter (for demo purposes) ---
    let jobIdCounter = 3; // Starting after initial sample jobs
    let userIdCounter = 8; // For Admin's user management, assuming admin, HR, candidate are 1,2,3
    let clientIdCounter = 3; // For Sales clients
    let reportIdCounter = 2; // For Sales reports
    let financeInvoiceIdCounter = 4; // For Finance Invoices data (client-side)
    let payoutIdCounter = 2; // For Finance Payouts data (worker-side, starting from 2 to align with PAY-WK-001, PAY-WK-002)

    // --- Sample Data ---
    // Store jobs with their generated IDs
    const postedJobs = {
        "JOB-QSE-001": { jobId: "JOB-QSE-001", jobTitle: "Quantum Software Engineer", workArea: "Hitech City", city: "Hyderabad", state: "Telangana", slotTime: "9:00 AM - 5:00 PM", hours: 8, salary: 95000, postedOn: "2025-07-10", status: "Active", applicants: 15, clientId: "CLI-001" },
        "JOB-AIML-002": { jobId: "JOB-AIML-002", jobTitle: "AI/ML Specialist", workArea: "Electronic City", city: "Bengaluru", state: "Karnataka", slotTime: "10:00 AM - 6:00 PM", hours: 8, salary: 80000, postedOn: "2025-07-05", status: "Active", applicants: 22, clientId: "CLI-002" },
        "JOB-FDR-003": { jobId: "JOB-FDR-003", jobTitle: "Frontend Developer (React)", workArea: "Guindy", city: "Chennai", state: "Tamil Nadu", slotTime: "9:30 AM - 5:30 PM", hours: 8, salary: 60000, postedOn: "2025-06-20", status: "Closed", applicants: 30, clientId: "CLI-003" },
    };
    const allJobApplicants = {
        "JOB-QSE-001": [
            { name: "Alice Johnson", contact: "alice@example.com", appliedOn: "2025-07-08", status: "Reviewing", resumeLink: "#" },
            { name: "Bob Williams", contact: "bob@example.com", appliedOn: "2025-07-09", status: "Interview Scheduled", resumeLink: "#" },
        ],
        "JOB-AIML-002": [
            { name: "Eve Brown", contact: "eve@example.com", appliedOn: "2025-07-01", status: "Interviewed", resumeLink: "#" },
            { name: "Frank White", contact: "frank@example.com", appliedOn: "2025-07-02", status: "Offer Extended", resumeLink: "#" },
        ],
        "JOB-FDR-003": [
            { name: "Grace Green", contact: "grace@example.com", appliedOn: "2025-06-18", status: "Hired", resumeLink: "#" },
            { name: "Henry Black", contact: "henry@example.com", appliedOn: "2025-06-19", status: "Rejected", resumeLink: "#" },
        ]
    };
    const hrSlotsData = [
        { jobRole: "Data Entry (Morning)", candidate: "John Doe", date: "2025-07-23", timeSlot: "9:00 AM - 1:00 PM", status: "Confirmed" },
        { jobRole: "Customer Support (Evening)", candidate: "Jane Smith", date: "2025-07-23", timeSlot: "5:00 PM - 9:00 PM", status: "Pending Confirmation" },
    ];
    // Consolidate all invoices into a single source
    const allInvoicesData = [
        { invoiceId: "INV-CL-001", clientWorker: "GlobalTech Solutions", amount: 50000, date: "2025-07-15", dueDate: "2025-07-15", status: "Paid", type: "Client", relatedId: "CLI-001" },
        { invoiceId: "INV-CL-002", clientWorker: "Innovate Corp", amount: 25000, date: "2025-07-20", dueDate: "2025-07-31", status: "Pending", type: "Client", relatedId: "CLI-002" },
        { invoiceId: "INV-CL-003", clientWorker: "FutureNet Services", amount: 75000, date: "2025-06-25", dueDate: "2025-06-30", status: "Paid", type: "Client", relatedId: "CLI-003" },
        // Sample worker payout invoices (generated by HR) - these are distinct from direct payroll payouts
        // These will be generated dynamically now, but keep as initial data for demonstration if needed.
        // For accurate demo, it's better to start these empty and generate them through HR.
    ];

    const hrAttendanceData = [ // HR's view of all attendance, now includes Candidate ID and Job ID
        { workerName: "Ramesh Kumar", candidateId: "CAND-001", jobId: "JOB-DE-001", date: "2025-07-21", checkIn: "09:00", checkOut: "17:00", workId: "WKID-DE-001", status: "Completed", invoiced: false }, // Added invoiced flag
        { workerName: "Priya Sharma", candidateId: "CAND-002", jobId: "JOB-CS-002", date: "2025-07-21", checkIn: "10:00", checkOut: "18:00", workId: "WKID-CS-002", status: "Completed", invoiced: false }, // Added invoiced flag
        { workerName: "Suresh Gupta", candidateId: "CAND-003", jobId: "JOB-DE-003", date: "2025-07-22", checkIn: "09:30", checkOut: "", workId: "WKID-DE-003", status: "Active", invoiced: false } // Added invoiced flag
    ];
    // Candidate - Available Slots data (dynamically updated by HR job postings)
    const candidateAvailableSlotsData = [
        { jobId: "JOB-DEA-004", jobRole: "Data Entry Assistant", workArea: "Perungudi", city: "Chennai", state: "Tamil Nadu", slotTime: "9:00 AM - 1:00 PM", hours: 4, amount: 800 },
        { jobId: "JOB-EP-005", jobRole: "Event Promoter", workArea: "Anna Nagar", city: "Chennai", state: "Tamil Nadu", slotTime: "4:00 PM - 8:00 PM", hours: 4, amount: 1200 },
        { jobId: "JOB-WH-006", jobRole: "Warehouse Helper", workArea: "Ambattur", city: "Chennai", state: "Tamil Nadu", slotTime: "10:00 AM - 6:00 PM", hours: 8, amount: 1500 },
        { jobId: "JOB-GD-007", jobRole: "Graphic Designer (Part-time)", workArea: "Remote", city: "Any", state: "Any", slotTime: "Flexible (4 hrs/day)", hours: 4, amount: 2000 },
    ];
    // Candidate - My Applications data with more details, now linked to Job ID
    const candidateMyApplicationsData = [
        { candidateId: "CAND-001", jobId: "JOB-QSE-001", jobTitle: "Quantum Software Engineer", workArea: "Hitech City", city: "Hyderabad", state: "Telangana", slotTime: "9:00 AM - 5:00 PM", hours: 8, applicationStatus: "Under Review", appliedOn: "2025-07-12" },
        { candidateId: "CAND-001", jobId: "JOB-AIML-002", jobTitle: "AI/ML Specialist", workArea: "Electronic City", city: "Bengaluru", state: "Karnataka", slotTime: "10:00 AM - 6:00 PM", hours: 8, applicationStatus: "Interview Scheduled", appliedOn: "2025-07-07" },
        { candidateId: "CAND-001", jobId: "JOB-EP-005", jobTitle: "Event Promoter", workArea: "Anna Nagar", city: "Chennai", state: "Tamil Nadu", slotTime: "4:00 PM - 8:00 PM", hours: 4, applicationStatus: "Pending", appliedOn: "2025-07-20" },
    ];
    // Sample data for Candidate Payment History, linked to Job ID and Candidate ID
    const candidatePaymentHistoryData = [
        { candidateId: "CAND-001", workId: "WKID-DE-001", jobId: "JOB-DE-001", jobRole: "Data Entry", date: "2025-07-21", amount: 800, status: "Paid" },
        { candidateId: "CAND-001", workId: "WKID-CS-002", jobId: "JOB-CS-002", jobRole: "Customer Support", date: "2025-07-21", amount: 1000, status: "Paid" },
        { candidateId: "CAND-001", workId: "WKID-DE-003", jobId: "JOB-DE-003", jobRole: "Delivery Executive", date: "2025-07-22", amount: "Pending Calc.", status: "Pending" }
    ];
    // Admin Users Data (extended)
    const adminUsersData = [
        { userId: "ADM-001", username: "admin@example.com", role: "Admin", lastLogin: "2025-07-22 21:00", status: "Active" },
        { userId: "HR-001", username: "hr@example.com", role: "HR", lastLogin: "2025-07-22 20:30", status: "Active" },
        { userId: "CAND-001", username: "9876543210", role: "Candidate", lastLogin: "2025-07-22 21:15", status: "Active" },
        { userId: "SAL-001", username: "sales@example.com", role: "Sales", lastLogin: "2025-07-21 14:00", status: "Active" },
        { userId: "FIN-001", username: "finance@example.com", role: "Finance", lastLogin: "2025-07-20 11:00", status: "Active" },
        { userId: "CAND-002", username: "priya_s", role: "Candidate", lastLogin: "2025-07-22 09:00", status: "Active" },
        { userId: "CAND-003", username: "suresh_g", role: "Candidate", lastLogin: "2025-07-22 09:30", status: "Active" },
        { userId: "INACT-001", username: "old_user", role: "Candidate", lastLogin: "2025-06-01 10:00", status: "Inactive" },
    ];
    // Admin Audit Log Data (original, will be populated dynamically)
    const adminAuditLogData = [
        { timestamp: "2025-07-22 21:10:05", user: "HR-001", action: "Post New Job", details: "JOB-ND-004 (New Driver)" },
        { timestamp: "2025-07-22 21:05:20", user: "CAND-001", action: "Check-in", details: "Work ID: WKID-DE-003" },
        { timestamp: "2025-07-22 20:45:10", user: "ADM-001", action: "Changed User Status", details: "User: HR-001, Status: Active" },
        { timestamp: "2025-07-21 17:00:00", user: "HR-001", action: "Manual Check-out", details: "Worker: Ramesh Kumar, Work ID: WKID-DE-001" },
        { timestamp: "2025-07-21 09:00:00", user: "CAND-001", action: "Check-in", details: "Work ID: WKID-DE-001" },
    ];

    // Sales Clients Data for Sales Dashboard & Admin Overview
    const salesClientsData = [
        { clientId: "CLI-001", companyName: "GlobalTech Solutions", gstNo: "22AAAAA0001A1Z1", companyAddress: "101 Cyber Rd, Hitech City, Hyderabad, 500081", employeeStrength: 500, contactPerson: "Amit Sharma", contactEmail: "amit.sharma@globaltech.com", contractValue: 50000, renewalDate: "2026-03-15", status: "Active", lastEngagement: "2025-07-15" },
        { clientId: "CLI-002", companyName: "Innovate Corp", gstNo: "33BBBBB0002B1Z2", companyAddress: "202 Startup Avenue, Electronic City, Bengaluru, 560100", employeeStrength: 120, contactPerson: "Priya Singh", contactEmail: "priya.singh@innovate.com", contractValue: 25000, renewalDate: "2025-11-01", status: "Active", lastEngagement: "2025-07-20" },
        { clientId: "CLI-003", companyName: "FutureNet Services", gstNo: "30CCCCC0003C1Z3", companyAddress: "Unit 303, Business Tower, Guindy, Chennai, 600032", employeeStrength: 80, contactPerson: "Rajesh Kumar", contactEmail: "rajesh.kumar@futurenet.com", contractValue: 0, renewalDate: "N/A", status: "Prospect", lastEngagement: "2025-07-21" },
    ];

    // Sales Reports Data for Sales Dashboard
    const salesReportsData = [
        { reportId: "SR-001", reportType: "Weekly Sales Summary", reportDate: "2025-07-19", totalRevenue: 120000, newLeads: 15, dealsClosed: 3 },
        { reportId: "SR-002", reportType: "Monthly Revenue Analysis", reportDate: "2025-06-30", totalRevenue: 450000, newLeads: 50, dealsClosed: 10 },
        { reportId: "SR-003", reportType: "Quarterly Performance", reportDate: "2025-06-30", totalRevenue: 1200000, newLeads: 150, dealsClosed: 25 },
    ];

    // Finance Payouts Data (Enriched with details for display)
    // This will be dynamically populated upon invoice generation
    const financePayoutsData = [
        { payoutId: "PAY-WK-001", payee: "Ramesh Kumar", workId: "WKID-DE-001", slotTime: "09:00 - 17:00", company: "GlobalTech Solutions", date: "2025-07-21", checkIn: "09:00", checkOut: "17:00", amount: 1000, status: "Pending" },
        { payoutId: "PAY-WK-002", payee: "Priya Sharma", workId: "WKID-CS-002", slotTime: "10:00 - 18:00", company: "Innovate Corp", date: "2025-07-21", checkIn: "10:00", checkOut: "18:00", amount: 1200, status: "Pending" },
    ];

    const loggedInCandidate = { id: "CAND-001", name: "Candidate User" }; // Fixed for demo

    let currentWorkingWorker = null; // To track a worker who has checked in but not out

    // Helper to get current formatted date (YYYY-MM-DD) for form default
    function getCurrentDateFormatted() {
        const today = new Date();
        const year = today.getFullYear();
        const month = String(today.getMonth() + 1).padStart(2, '0');
        const day = String(today.getDate()).padStart(2, '0');
        return `${year}-${month}-${day}`;
    }

    // Helper to get current formatted time (HH:MM) for form default
    function getCurrentTimeFormatted() {
        const now = new Date();
        const hours = String(now.getHours()).padStart(2, '0');
        const minutes = String(now.getMinutes()).padStart(2, '0');
        return `${hours}:${minutes}`;
    }

    // Helper to get current formatted timestamp (YYYY-MM-DD HH:MM:SS) for audit logs
    function getCurrentTimestampFormatted() {
        const now = new Date();
        const year = now.getFullYear();
        const month = String(now.getMonth() + 1).padStart(2, '0');
        const day = String(now.getDate()).padStart(2, '0');
        const hours = String(now.getHours()).padStart(2, '0');
        const minutes = String(now.getMinutes()).padStart(2, '0');
        const seconds = String(now.getSeconds()).padStart(2, '0');
        return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;
    }


    // Helper to calculate hours between two time strings (HH:MM)
    function calculateHours(startTime, endTime) {
        if (!startTime || !endTime) return 0;
        try {
            const start = new Date(`2000-01-01T${startTime}:00`);
            const end = new Date(`2000-01-01T${endTime}:00`);
            const diffMs = end - start;
            return diffMs / (1000 * 60 * 60); // Convert milliseconds to hours
        } catch (e) {
            console.error("Error calculating hours:", e);
            return 0; // Return 0 on invalid time format
        }
    }


    function showSection(sectionId) {
        const allSections = document.querySelectorAll('section');
        allSections.forEach(section => {
            section.classList.add('hidden');
        });
        document.getElementById(sectionId).classList.remove('hidden');

        const navLoginTabs = document.getElementById('nav-login-tabs');
        if (sectionId.startsWith('login')) {
            navLoginTabs.style.display = 'flex';
            setActiveTab(sectionId);
        } else {
            navLoginTabs.style.display = 'none';
        }
    }

    function setActiveTab(activeLoginId) {
        const tabs = document.querySelectorAll('#nav-login-tabs button');
        tabs.forEach(btn => {
            btn.classList.toggle('active', btn.dataset.target === activeLoginId);
        });
    }

    function handleLogin(event) {
        event.preventDefault();
        const role = event.target.dataset.role;
        // For demo, accept any input as valid
        if (role === 'candidate') {
            showSection('dashboard-' + role);
            populateCandidateAttendanceForm(); // Pre-fill attendance form on candidate login
            populateCandidateAttendanceTable(); // Directly load attendance for candidate on login
            setDashboardActiveTab('dashboard-candidate', null); // No button active initially for primary view
        } else if (role === 'admin') { // Admin login
            showSection('dashboard-' + role);
            populateAdminAuditLogsTable(); // Show audit logs as default for admin
            setDashboardActiveTab('dashboard-admin', 'admin-audit-logs-btn'); // Activate audit logs button
        } else if (role === 'sales') { // Sales login
            showSection('dashboard-' + role);
            populateSalesClientsTable(); // Show clients & contracts by default
            setDashboardActiveTab('dashboard-sales', 'sales-clients-contracts-btn'); // Activate clients button
        } else if (role === 'finance') { // Finance login
            showSection('dashboard-' + role);
            populateFinanceInvoicesTable(); // Show invoices & payments by default
            setDashboardActiveTab('dashboard-finance', 'finance-invoices-payments-btn'); // Activate invoices button
        }
        else {
            showSection('dashboard-' + role);
        }
        // Record login in audit log
        adminAuditLogData.push({
            timestamp: getCurrentTimestampFormatted(),
            user: `${role}@example.com`, // Using email as user identifier for demo
            action: "Login",
            details: `User logged in as ${role}`
        });
    }

    function logout() {
        alert('Logged out!');
        showSection('login-hr');
        // Record logout in audit log
        adminAuditLogData.push({
            timestamp: getCurrentTimestampFormatted(),
            user: "Logged Out User", // Cannot get specific user easily after logout
            action: "Logout",
            details: `User logged out`
        });
    }

    // HR Job Posting: Populate Client Company dropdown
    function populateClientCompanyDropdown() {
        const clientDropdown = document.getElementById('job-client-id');
        clientDropdown.innerHTML = '<option value="">-- Select Client --</option>'; // Clear existing options

        salesClientsData.forEach(client => {
            const option = document.createElement('option');
            option.value = client.clientId;
            option.textContent = client.companyName;
            clientDropdown.appendChild(option);
        });
    }

    // Function to show the job post form (HR)
    function showPostJobForm() {
        document.getElementById('form-post-job').reset(); // Clear form on opening
        populateClientCompanyDropdown(); // Populate client dropdown
        showSection('hr-post-job'); // Hide current dashboard, show job post form
    }

    // Function to handle job post submission (HR)
    function handlePostJob(event) {
        event.preventDefault(); // Prevent default form submission

        const jobTitle = document.getElementById('job-role').value; // Changed to jobTitle
        const slotTimeStart = document.getElementById('slot-time-start').value;
        const slotTimeEnd = document.getElementById('slot-time-end').value;
        const workArea = document.getElementById('work-area').value;
        const city = document.getElementById('city').value;
        const state = document.getElementById('state').value;
        const salary = document.getElementById('salary').value;
        const clientId = document.getElementById('job-client-id').value; // NEW: Get client ID

        if (!clientId) {
            alert("Please select a Client Company for the job.");
            return;
        }

        const postedOn = getCurrentDateFormatted(); // Current date for new jobs

        // Generate unique Job ID
        jobIdCounter++;
        const jobTitlePrefix = jobTitle.replace(/[^a-zA-Z0-9]/g, '').substring(0,3).toUpperCase();
        const jobId = `JOB-${jobTitlePrefix}-${String(jobIdCounter).padStart(3, '0')}`;


        // Calculate hours for the slot
        const hours = calculateHours(slotTimeStart, slotTimeEnd);
        const formattedHours = hours.toFixed(1);

        const clientCompany = salesClientsData.find(c => c.clientId === clientId).companyName; // Get client name

        // Create new job object
        const newJob = {
            jobId,
            jobTitle,
            workArea,
            city,
            state,
            slotTime: `${slotTimeStart} - ${slotTimeEnd}`,
            hours: parseFloat(formattedHours),
            salary: parseFloat(salary),
            postedOn,
            status: "Active",
            applicants: 0,
            clientId: clientId, // Store client ID
            clientCompany: clientCompany // Store client Company name for display
        };
        postedJobs[jobId] = newJob; // Store the new job with its ID

        // Add empty applicant list for the new job ID
        allJobApplicants[jobId] = [];
        // Create a new table row for the job postings table (HR View)
        const jobTableBody = document.querySelector('#job-postings-table tbody');
        const newRow = jobTableBody.insertRow(0); // Insert at the top
        newRow.dataset.jobId = jobId;
        newRow.dataset.jobRole = jobTitle;

        // Insert cells for the new row
        newRow.insertCell(0).textContent = jobId;
        newRow.insertCell(1).textContent = jobTitle;
        newRow.insertCell(2).textContent = 'Active';
        const applicantCountCell = newRow.insertCell(3);
        const applicantCountSpan = document.createElement('span');
        applicantCountSpan.className = 'applicant-count';
        applicantCountSpan.textContent = 0;
        applicantCountSpan.dataset.jobId = jobId;
        applicantCountCell.appendChild(applicantCountSpan);
        applicantCountSpan.addEventListener('click', () => showApplicantsList(jobId));
        newRow.insertCell(4).textContent = `${slotTimeStart} - ${slotTimeEnd}`;
        newRow.insertCell(5).textContent = workArea;
        newRow.insertCell(6).textContent = `${city}, ${state}`;
        newRow.insertCell(7).textContent = salary;
        newRow.insertCell(8).textContent = postedOn;
        newRow.insertCell(9).textContent = clientCompany; // NEW: Display Client Company

        // Add this new job to the candidate's available slots data
        candidateAvailableSlotsData.push({ jobId, ...newJob });
        const jobDetailsAlert = `
            Job Posted Successfully!
            ------------------------
            Job ID: ${jobId}
            Role: ${jobTitle}
            Client: ${clientCompany}
            Slot: ${slotTimeStart} - ${slotTimeEnd} (${formattedHours} hrs)
            Work Area: ${workArea}
            Location: ${city}, ${state}
            Salary: Rs. ${salary}
            Posted On: ${postedOn}
        `;
        alert(jobDetailsAlert);
        // Clear the form fields after submission
        document.getElementById('form-post-job').reset();
        // After submission, return to HR Dashboard
        showSection('dashboard-hr');
        // Record action in audit log
        adminAuditLogData.push({
            timestamp: getCurrentTimestampFormatted(),
            user: "hr@example.com",
            action: "Post New Job",
            details: `ID: ${jobId}, Title: ${jobTitle}, Client: ${clientCompany}`
        });
    }

    // Function to display applicants for a specific job (HR)
    function showApplicantsList(jobId) { // Now takes jobId
        const applicantsListBody = document.getElementById('applicants-detail-body');
        applicantsListBody.innerHTML = ''; // Clear previous applicants

        const jobTitle = postedJobs[jobId] ? postedJobs[jobId].jobTitle : jobId; // Get job title or use ID
        document.getElementById('applicants-list-title').textContent = `Applicants for ${jobTitle} (${jobId})`;

        const applicants = allJobApplicants[jobId];

        if (applicants && applicants.length > 0) {
            applicants.forEach(applicant => {
                const row = applicantsListBody.insertRow();
                row.insertCell(0).textContent = applicant.name;
                row.insertCell(1).textContent = applicant.contact;
                row.insertCell(2).textContent = applicant.appliedOn;
                row.insertCell(3).textContent = applicant.status;
                const resumeCell = row.insertCell(4);
                const resumeLink = document.createElement('a');
                resumeLink.href = applicant.resumeLink;
                resumeLink.textContent = "View";
                resumeLink.target = "_blank"; // Open in new tab
                resumeCell.appendChild(resumeLink);
            });
        } else {
            const row = applicantsListBody.insertRow();
            const cell = row.insertCell(0);
            cell.colSpan = 5; // Span all columns
            cell.textContent = "No applicants for this job yet.";
            cell.style.textAlign = "center";
            cell.style.fontStyle = "italic";
            cell.style.padding = "20px";
        }

        showSection('hr-applicants-list');
    }

    // Function to display Slots & Assignments (HR)
    function showSlotsAssignments() {
        const slotsBody = document.getElementById('slots-assignments-body');
        slotsBody.innerHTML = ''; // Clear previous data

        if (hrSlotsData.length > 0) {
            hrSlotsData.forEach(slot => {
                const row = slotsBody.insertRow();
                row.insertCell(0).textContent = slot.jobRole;
                row.insertCell(1).textContent = slot.candidate;
                row.insertCell(2).textContent = slot.date;
                row.insertCell(3).textContent = slot.timeSlot;
                row.insertCell(4).textContent = slot.status;
            });
        } else {
            const row = slotsBody.insertRow();
            const cell = row.insertCell(0);
            cell.colSpan = 5;
            cell.textContent = "No slots or assignments to display.";
            cell.style.textAlign = "center";
            cell.style.fontStyle = "italic";
            cell.style.padding = "20px";
        }
        showSection('hr-slots-assignments');
    }

    // Function to display Invoices & Payments (HR)
    function showInvoicesPayments() {
        const invoicesBody = document.getElementById('invoices-payments-body');
        invoicesBody.innerHTML = ''; // Clear previous data

        // Filter for client invoices specifically for HR's view
        const hrClientInvoices = allInvoicesData.filter(inv => inv.type === 'Client');

        if (hrClientInvoices.length > 0) {
            hrClientInvoices.forEach(invoice => {
                const row = invoicesBody.insertRow();
                row.insertCell(0).textContent = invoice.invoiceId;
                row.insertCell(1).textContent = invoice.clientWorker;
                row.insertCell(2).textContent = invoice.amount;
                row.insertCell(3).textContent = invoice.date;
                row.insertCell(4).textContent = invoice.dueDate;
                row.insertCell(5).textContent = invoice.status;
                const actionCell = row.insertCell(6);
                // HR's action on client invoices for demo: only if status is Pending
                if (invoice.status === "Pending") {
                    const actionButton = document.createElement('button');
                    actionButton.textContent = "Send Reminder";
                    actionButton.className = 'action-btn-finance';
                    actionButton.onclick = () => {
                        alert(`Reminder sent for ${invoice.invoiceId}!`);
                        // In a real app, update status or log
                    };
                    actionCell.appendChild(actionButton);
                } else {
                    actionCell.textContent = "N/A";
                }
            });
        } else {
            const row = invoicesBody.insertRow();
            const cell = row.insertCell(0);
            cell.colSpan = 7;
            cell.textContent = "No client invoices or payments to display.";
            cell.style.textAlign = "center";
            cell.style.fontStyle = "italic";
            cell.style.padding = "20px";
        }
        showSection('hr-invoices-payments');
    }

    // Function to display attendance records (HR)
    function populateAttendanceTable() {
        const attendanceBody = document.getElementById('attendance-records-body');
        attendanceBody.innerHTML = ''; // Clear previous data

        // Get a sorted list (most recent first)
        const sortedAttendance = [...hrAttendanceData].sort((a, b) => {
            const dateA = new Date(`${a.date}T${a.checkIn || '00:00'}`);
            const dateB = new Date(`${b.date}T${b.checkIn || '00:00'}`);
            return dateB - dateA;
        });
        if (sortedAttendance.length > 0) {
            sortedAttendance.forEach(record => {
                const row = attendanceBody.insertRow();
                row.insertCell(0).textContent = record.workerName;
                row.insertCell(1).textContent = record.jobId; // Display Job ID
                row.insertCell(2).textContent = record.date;
                row.insertCell(3).textContent = record.checkIn;
                row.insertCell(4).textContent = record.checkOut;
                row.insertCell(5).textContent = record.workId;
                row.insertCell(6).textContent = record.status;
            });
        } else {
            const row = attendanceBody.insertRow();
            const cell = row.insertCell(0);
            cell.colSpan = 7;
            cell.textContent = "No attendance records to display.";
            cell.style.textAlign = "center";
            cell.style.fontStyle = "italic";
            cell.style.padding = "20px";
        }
    }

    // Function to handle Check-in (HR)
    function handleCheckIn() {
        const workerName = document.getElementById('worker-name').value;
        const jobId = document.getElementById('job-id-for-attendance').value; // Changed to jobId
        const attendanceDate = document.getElementById('attendance-date').value;
        let checkInTime = document.getElementById('check-in-time').value; // Use let as it might be updated

        // If checkInTime is empty, auto-populate with current time
        if (!checkInTime) {
            checkInTime = getCurrentTimeFormatted();
            document.getElementById('check-in-time').value = checkInTime; // Update the input field
        }

        if (!workerName || !jobId || !attendanceDate || !checkInTime) {
            alert("Please fill in Worker Name, Job ID, Date, and Check-in Time to mark attendance.");
            return;
        }
        if (!postedJobs[jobId]) {
            alert("Invalid Job ID for attendance. Please enter a valid Job ID.");
            return;
        }


        const existingActiveRecord = hrAttendanceData.find(record =>
            record.workerName === workerName &&
            record.jobId === jobId && // Check by jobId now
            record.date === attendanceDate &&
            record.status === "Active"
        );
        if (existingActiveRecord) {
            alert(`${workerName} is already checked in for Job ID ${jobId} on ${attendanceDate}. Please check out first.`);
            return;
        }

        const workId = `WKID-${Math.random().toString(36).substr(2, 6).toUpperCase()}`;
        // Simulate finding candidate ID based on worker name (for HR's manual entry)
        let candidateIdForHR = null;
        const matchingUser = adminUsersData.find(user => user.username === workerName || (user.role === 'Candidate' && user.username === '9876543210' && workerName === loggedInCandidate.name));
        if (matchingUser) {
            candidateIdForHR = matchingUser.userId;
        } else {
            // If not found in demo users, assign a generic one or generate new
            // For simplicity, let's assume if it's the demo candidate name, use CAND-001
            if (workerName === loggedInCandidate.name) {
                candidateIdForHR = loggedInCandidate.id;
            } else {
                candidateIdForHR = `CAND-${String(userIdCounter++).padStart(3,'0')}`;
                adminUsersData.push({userId: candidateIdForHR, username: workerName, role: 'Candidate', lastLogin: getCurrentTimestampFormatted(), status: 'Active'});
            }
        }


        const newRecord = {
            workerName,
            candidateId: candidateIdForHR, // Add candidate ID
            jobId, // Store jobId
            date: attendanceDate,
            checkIn: checkInTime,
            checkOut: "",
            workId,
            status: "Active"
        };

        hrAttendanceData.push(newRecord);
        // Also add to candidate's attendance data if it's "our" candidate (for demo purposes)
        if (candidateIdForHR === loggedInCandidate.id) { // Only update if it's the currently logged-in demo candidate
            candidateMyAttendanceData.push({
                candidateId: newRecord.candidateId,
                jobId: newRecord.jobId,
                date: newRecord.date,
                checkIn: newRecord.checkIn,
                checkOut: newRecord.checkOut,
                workId: newRecord.workId,
                status: newRecord.status
            });
        }


        populateAttendanceTable(); // Refresh HR's table
        // If we are currently in candidate dashboard attendance view, refresh it too
        if (!document.getElementById('dashboard-candidate').classList.contains('hidden')) { // Check if main dashboard is visible
            populateCandidateAttendanceTable();
        }

        document.getElementById('check-in-time').value = ""; // Clear check-in time for next entry
        document.getElementById('check-out-time').value = ""; // Clear check-out time for next entry

        currentWorkingWorker = newRecord; // Keep track of the active worker for potential auto-fill on checkout

        alert(`Checked in ${workerName} for Job ID ${jobId} on ${attendanceDate} at ${checkInTime}.\nWork ID: ${workId}`);
        // Record action in audit log
        adminAuditLogData.push({
            timestamp: getCurrentTimestampFormatted(),
            user: "hr@example.com",
            action: "Manual Check-in",
            details: `Worker: ${workerName}, Job ID: ${jobId}, Work ID: ${workId}`
        });
    }

    // Function to handle Check-out (HR)
    function handleCheckOut() {
        const workerName = document.getElementById('worker-name').value;
        const jobId = document.getElementById('job-id-for-attendance').value; // Changed to Job ID
        const attendanceDate = document.getElementById('attendance-date').value;
        let checkOutTime = document.getElementById('check-out-time').value;

        if (!checkOutTime) {
            checkOutTime = getCurrentTimeFormatted();
            document.getElementById('check-out-time').value = checkOutTime;
        }

        if (!workerName || !jobId || !attendanceDate || !checkOutTime) {
            alert("Please fill in Worker Name, Job ID, Date, and Check-out Time to mark check-out.");
            return;
        }
        if (!postedJobs[jobId]) {
            alert("Invalid Job ID for attendance. Cannot check out for an unknown Job ID.");
            return;
        }

        const recordToUpdate = hrAttendanceData.find(record =>
            record.workerName === workerName &&
            record.jobId === jobId && // Check by jobId now
            record.date === attendanceDate &&
            record.status === "Active"
        );
        if (recordToUpdate) {
            recordToUpdate.checkOut = checkOutTime;
            recordToUpdate.status = "Completed";
            populateAttendanceTable(); // Refresh HR's table

            // Update candidate's attendance data as well if applicable
            if (recordToUpdate.candidateId === loggedInCandidate.id) {
                const candidateRecordToUpdate = candidateMyAttendanceData.find(record =>
                    record.jobId === jobId &&
                    record.date === attendanceDate &&
                    record.workId === recordToUpdate.workId &&
                    record.status === "Active"
                );
                if (candidateRecordToUpdate) {
                    candidateRecordToUpdate.checkOut = checkOutTime;
                    candidateRecordToUpdate.status = "Completed";

                    // Add to candidate's payment history
                    const job = postedJobs[jobId] || { salary: 100, hours: 1 }; // Fallback values
                    const hoursWorked = calculateHours(recordToUpdate.checkIn, recordToUpdate.checkOut);
                    const estimatedRatePerHour = job.salary / (job.hours || 1); // Calculate rate based on job or default
                    const amountEarned = hoursWorked * estimatedRatePerHour;
                    candidatePaymentHistoryData.push({
                        candidateId: loggedInCandidate.id, // Ensure candidateId is stored
                        workId: recordToUpdate.workId,
                        jobId: recordToUpdate.jobId, // Add jobId to payment history
                        jobRole: job.jobTitle || "Unknown Job",
                        date: recordToUpdate.date,
                        amount: amountEarned.toFixed(2),
                        status: "Pending Payment"
                    });
                }
            }

            // If candidate dashboard is visible, refresh its attendance table
            if (!document.getElementById('dashboard-candidate').classList.contains('hidden')) {
                populateCandidateAttendanceTable();
            }


            document.getElementById('form-mark-attendance').reset();
            currentWorkingWorker = null;
            alert(`Checked out ${workerName} for Job ID ${jobId} on ${attendanceDate} at ${checkOutTime}.\nWork ID: ${recordToUpdate.workId}`);
            // Record action in audit log
            adminAuditLogData.push({
                timestamp: getCurrentTimestampFormatted(),
                user: "hr@example.com",
                action: "Manual Check-out",
                details: `Worker: ${workerName}, Job ID: ${jobId}, Work ID: ${recordToUpdate.workId}`
            });
        } else {
            alert(`No active check-in found for ${workerName} for Job ID ${jobId} on ${attendanceDate}. Please check in first.`);
        }
    }

    // Function to generate Invoice (HR) - MODIFIED FOR PER WORK ID INVOICING
    function generateInvoiceForSelected() {
        const unbilledRecords = hrAttendanceData.filter(record => record.status === "Completed" && !record.invoiced);
        if (unbilledRecords.length === 0) {
            alert("No completed and unbilled attendance records to generate invoices for.");
            return;
        }

        let generatedInvoiceSummaries = []; // To summarize what was generated

        unbilledRecords.forEach(record => {
            const hoursWorked = calculateHours(record.checkIn, record.checkOut);
            const job = postedJobs[record.jobId];
            
            // Handle cases where job might not be found or has no client info
            const clientCompany = job ? (salesClientsData.find(c => c.clientId === job.clientId)?.companyName || "Unknown Client") : "Unknown Client";
            const estimatedRatePerHour = job ? (job.salary / (job.hours || 1)) : 0; // Handle if job not found
            const amount = hoursWorked * estimatedRatePerHour;

            // Generate unique Invoice ID for this specific work record
            const invoiceId = `INV-WK-${String(financeInvoiceIdCounter++).padStart(3, '0')}`;
            const payoutId = `PAY-WK-${String(payoutIdCounter++).padStart(3, '0')}`;
            const today = getCurrentDateFormatted(); // Invoice date
            const dueDate = new Date(today);
            dueDate.setDate(dueDate.getDate() + 7);
            const formattedDueDate = `${dueDate.getFullYear()}-${String(dueDate.getMonth() + 1).padStart(2, '0')}-${String(dueDate.getDate()).padStart(2, '0')}`;

            // Add to allInvoicesData (Finance view of all invoices)
            allInvoicesData.push({
                invoiceId: invoiceId,
                clientWorker: record.workerName, // Worker is the 'client' for payouts
                amount: parseFloat(amount.toFixed(2)),
                date: record.date, // Invoice is for this specific work date
                dueDate: formattedDueDate,
                status: "Generated",
                type: "Worker Payout",
                relatedId: record.workId // Link to the specific work ID
            });

            // Add to financePayoutsData (Detailed Finance payroll view)
            financePayoutsData.push({
                payoutId: payoutId,
                payee: record.workerName,
                workId: record.workId,
                slotTime: job ? job.slotTime : "N/A",
                company: clientCompany,
                date: record.date, // Payout date is work date
                checkIn: record.checkIn,
                checkOut: record.checkOut,
                amount: parseFloat(amount.toFixed(2)),
                status: "Pending" // Initial status for finance payout
            });

            // Mark the original attendance record as invoiced
            record.invoiced = true;
            record.status = "Invoiced";

            generatedInvoiceSummaries.push(`${record.workerName} for Job ID ${record.jobId} (Work ID: ${record.workId}) - Amount: Rs. ${amount.toFixed(2)} - Invoice ID: ${invoiceId}`);
        });

        populateAttendanceTable(); // Refresh HR's attendance table
        populateFinanceInvoicesTable(); // Refresh Finance's invoices table
        populateFinancePayrollTable(); // Refresh Finance's payroll table

        alert(`Invoices Generated:\n\n${generatedInvoiceSummaries.join('\n')}\n\nAll relevant tables updated.`);
        // Record action in audit log
        adminAuditLogData.push({
            timestamp: getCurrentTimestampFormatted(),
            user: "hr@example.com",
            action: "Generate Worker Payout Invoices",
            details: `Generated ${generatedInvoiceSummaries.length} individual payout invoices.`
        });
    }


    // Function to display available slots for candidates
    function showAvailableSlots() {
        // Hide the default attendance form and table in candidate dashboard
        document.getElementById('candidate-attendance-form-container').classList.add('hidden');
        document.getElementById('dashboard-candidate').querySelector('h3').classList.add('hidden'); // "My Attendance & Work IDs" heading
        document.getElementById('candidate-attendance-body').parentNode.classList.add('hidden'); // The attendance table itself

        const availableSlotsBody = document.getElementById('available-slots-body');
        availableSlotsBody.innerHTML = ''; // Clear previous data

        // Filter for active jobs only
        const activeAvailableSlots = Object.values(postedJobs).filter(job => job.status === 'Active');
        if (activeAvailableSlots.length > 0) {
            activeAvailableSlots.forEach(job => { // Use job object directly
                const row = availableSlotsBody.insertRow();
                row.insertCell(0).textContent = job.jobId; // Display Job ID
                row.insertCell(1).textContent = job.jobTitle;
                row.insertCell(2).textContent = job.workArea;
                row.insertCell(3).textContent = job.city;
                row.insertCell(4).textContent = job.state;
                row.insertCell(5).textContent = job.slotTime;
                row.insertCell(6).textContent = `${job.hours} hrs`; // Display hours
                row.insertCell(7).textContent = `Rs. ${job.salary}`; // Amount (using salary as per job post)

                const actionCell = row.insertCell(8); // New cell for the button
                const applyButton = document.createElement('button');
                applyButton.textContent = 'Apply Now';
                applyButton.classList.add('apply-now-btn'); // Add a class for potential styling
                applyButton.style.padding = '5px 10px';
                applyButton.style.marginBottom = '0';
                applyButton.style.width = 'fit-content';
                applyButton.onclick = () => handleApplyForJob(job.jobId); // Attach click handler
                actionCell.appendChild(applyButton);
            });
        } else {
            const row = availableSlotsBody.insertRow();
            const cell = row.insertCell(0);
            cell.colSpan = 9; // Updated colspan
            cell.textContent = "No available job slots at the moment. Please check back later!";
            cell.style.textAlign = "center";
            cell.style.fontStyle = "italic";
            cell.style.padding = "20px";
        }
        showSection('candidate-available-slots');
    }

    // Function to handle applying for a job (Candidate)
    function handleApplyForJob(jobId) {
        const jobToApply = postedJobs[jobId];
        if (!jobToApply) {
            alert("Job not found.");
            return;
        }

        // Check if the candidate has already applied for this job
        const alreadyApplied = candidateMyApplicationsData.some(
            app => app.candidateId === loggedInCandidate.id && app.jobId === jobId
        );

        if (alreadyApplied) {
            alert(`You have already applied for ${jobToApply.jobTitle} (Job ID: ${jobId}).`);
            return;
        }

        const applicationDate = getCurrentDateFormatted();

        // Add to candidate's applications
        candidateMyApplicationsData.push({
            candidateId: loggedInCandidate.id,
            jobId: jobToApply.jobId,
            jobTitle: jobToApply.jobTitle,
            workArea: jobToApply.workArea,
            city: jobToApply.city,
            state: jobToApply.state,
            slotTime: jobToApply.slotTime,
            hours: jobToApply.hours,
            applicationStatus: "Pending", // Initial status
            appliedOn: applicationDate
        });

        // Add to HR's job applicants list
        if (!allJobApplicants[jobId]) {
            allJobApplicants[jobId] = [];
        }
        allJobApplicants[jobId].push({
            name: loggedInCandidate.name,
            contact: loggedInCandidate.id === "CAND-001" ? "9876543210" : "candidate_contact@example.com", // Adjust contact info as needed
            appliedOn: applicationDate,
            status: "Pending",
            resumeLink: "#" // Placeholder for resume link
        });

        // Update the applicant count in the HR dashboard's job postings table
        const hrJobPostingRow = document.querySelector(`#job-postings-table tbody tr[data-job-id="${jobId}"]`);
        if (hrJobPostingRow) {
            const applicantCountSpan = hrJobPostingRow.querySelector('.applicant-count');
            if (applicantCountSpan) {
                jobToApply.applicants = (jobToApply.applicants || 0) + 1; // Increment applicant count in data
                applicantCountSpan.textContent = jobToApply.applicants; // Update displayed count
            }
        }


        alert(`Successfully applied for: ${jobToApply.jobTitle} (Job ID: ${jobId})`);

        // Optionally, navigate to "My Applications" after applying
        showMyApplications();
        setDashboardActiveTab('dashboard-candidate', 'my-applications-cand-btn');

        // Record action in audit log
        adminAuditLogData.push({
            timestamp: getCurrentTimestampFormatted(),
            user: `${loggedInCandidate.id} (${loggedInCandidate.name})`,
            action: "Applied for Job",
            details: `Job ID: ${jobId}, Job Title: ${jobToApply.jobTitle}`
        });
    }

    // Function to display candidate's applications
    function showMyApplications() {
        // Hide the default attendance form and table in candidate dashboard
        document.getElementById('candidate-attendance-form-container').classList.add('hidden');
        document.getElementById('dashboard-candidate').querySelector('h3').classList.add('hidden');
        document.getElementById('candidate-attendance-body').parentNode.classList.add('hidden');

        const myApplicationsBody = document.getElementById('my-applications-body');
        myApplicationsBody.innerHTML = ''; // Clear previous data

        // Filter applications for the logged-in candidate
        const filteredApplications = candidateMyApplicationsData.filter(
            app => app.candidateId === loggedInCandidate.id // Filter by candidate ID
        ).sort((a, b) => new Date(b.appliedOn) - new Date(a.appliedOn)); // Sort by applied date

        if (filteredApplications.length > 0) {
            filteredApplications.forEach(application => {
                const row = myApplicationsBody.insertRow();
                row.insertCell(0).textContent = application.jobId; // Display Job ID
                row.insertCell(1).textContent = application.jobTitle;
                row.insertCell(2).textContent = application.workArea;
                row.insertCell(3).textContent = application.city;
                row.insertCell(4).textContent = application.state;
                row.insertCell(5).textContent = application.slotTime;
                row.insertCell(6).textContent = `${application.hours} hrs`;
                row.insertCell(7).textContent = application.applicationStatus;
                row.insertCell(8).textContent = application.appliedOn;
            });
        } else {
            const row = myApplicationsBody.insertRow();
            const cell = row.insertCell(0);
            cell.colSpan = 9; // Updated colspan to match new headers
            cell.textContent = "You haven't applied for any jobs yet.";
            cell.style.textAlign = "center";
            cell.style.fontStyle = "italic";
            cell.style.padding = "20px";
        }
        showSection('candidate-my-applications');
    }

    // Function to populate candidate's attendance records table (called on load and refresh)
    function populateCandidateAttendanceTable() {
        // Ensure the default attendance form and table are visible when this is the primary view
        document.getElementById('candidate-attendance-form-container').classList.remove('hidden');
        document.getElementById('dashboard-candidate').querySelector('h3').classList.remove('hidden');
        document.getElementById('candidate-attendance-body').parentNode.classList.remove('hidden');

        const candidateAttendanceBody = document.getElementById('candidate-attendance-body');
        candidateAttendanceBody.innerHTML = ''; // Clear previous data

        // Filter attendance records by logged-in candidate's ID
        const filteredAttendance = candidateMyAttendanceData.filter(
            record => record.candidateId === loggedInCandidate.id
        ).sort((a, b) => { // Sort by date and time, most recent first
                const dateA = new Date(`${a.date}T${a.checkIn || '00:00'}`);
                const dateB = new Date(`${b.date}T${b.checkIn || '00:00'}`);
                return dateB - dateA;
            });
        if (filteredAttendance.length > 0) {
            filteredAttendance.forEach(record => {
                const row = candidateAttendanceBody.insertRow();
                row.insertCell(0).textContent = record.jobId; // Display Job ID
                row.insertCell(1).textContent = record.date;
                row.insertCell(2).textContent = record.checkIn;
                row.insertCell(3).textContent = record.checkOut;
                row.insertCell(4).textContent = record.workId;
                row.insertCell(5).textContent = record.status;
            });
        } else {
            const row = candidateAttendanceBody.insertRow();
            const cell = row.insertCell(0);
            cell.colSpan = 6; // Match number of columns in header
            cell.textContent = "No attendance records found yet.";
            cell.style.textAlign = "center";
            cell.style.fontStyle = "italic";
            cell.style.padding = "20px";
        }
    }

    // Function to populate candidate attendance form fields
    function populateCandidateAttendanceForm() {
        document.getElementById('form-candidate-attendance').reset();
        document.getElementById('candidate-attendance-date').value = getCurrentDateFormatted();
        document.getElementById('candidate-check-in-time').value = getCurrentTimeFormatted(); // Pre-fill check-in time
        document.getElementById('candidate-check-out-time').value = ""; // Clear check-out time
    }

    // Candidate Check-in logic
    function handleCandidateCheckIn() {
        const jobId = document.getElementById('candidate-job-id').value; // Changed to jobId
        const attendanceDate = document.getElementById('candidate-attendance-date').value;
        let checkInTime = document.getElementById('candidate-check-in-time').value;
        if (!checkInTime) {
            checkInTime = getCurrentTimeFormatted();
            document.getElementById('candidate-check-in-time').value = checkInTime;
        }

        if (!jobId || !attendanceDate || !checkInTime) {
            alert("Please fill in Job ID, Date, and Check-in Time.");
            return;
        }
        if (!postedJobs[jobId]) {
            alert("Invalid Job ID. Please enter a valid Job ID from available slots or your applications.");
            return;
        }

        const candidateId = loggedInCandidate.id; // Get logged-in candidate ID

        // Check for an active session for this candidate and job on this date
        const existingActiveRecord = candidateMyAttendanceData.find(record =>
            record.candidateId === candidateId &&
            record.jobId === jobId &&
            record.date === attendanceDate &&
            record.status === "Active"
        );
        if (existingActiveRecord) {
            alert(`You are already checked in for Job ID ${jobId} on ${attendanceDate}. Please check out first.`);
            return;
        }

        const workId = `WKID-${Math.random().toString(36).substr(2, 6).toUpperCase()}`;
        const newRecord = {
            candidateId: candidateId, // Include candidate ID
            jobId: jobId, // Store jobId
            date: attendanceDate,
            checkIn: checkInTime,
            checkOut: "",
            workId,
            status: "Active"
        };
        candidateMyAttendanceData.push(newRecord);
        // Also update HR's data (assuming this is the centralized data source)
        hrAttendanceData.push({ workerName: loggedInCandidate.name, ...newRecord });
        populateCandidateAttendanceTable(); // Refresh candidate's table
        populateCandidateAttendanceForm(); // Reset form and pre-fill for next action
        alert(`Checked in for Job ID ${jobId} on ${attendanceDate} at ${checkInTime}.\nYour Work ID: ${workId}`);
        // Record action in audit log
        adminAuditLogData.push({
            timestamp: getCurrentTimestampFormatted(),
            user: `${loggedInCandidate.id} (${loggedInCandidate.name})`,
            action: "Check-in",
            details: `Job ID: ${jobId}, Work ID: ${workId}`
        });
    }

    // Candidate Check-out logic
    function handleCandidateCheckOut() {
        const jobId = document.getElementById('candidate-job-id').value; // Changed to jobId
        const attendanceDate = document.getElementById('candidate-attendance-date').value;
        let checkOutTime = document.getElementById('candidate-check-out-time').value;

        if (!checkOutTime) {
            checkOutTime = getCurrentTimeFormatted();
            document.getElementById('candidate-check-out-time').value = checkOutTime;
        }

        if (!jobId || !attendanceDate || !checkOutTime) {
            alert("Please fill in Job ID, Date, and Check-out Time.");
            return;
        }
        if (!postedJobs[jobId]) {
            alert("Invalid Job ID. Cannot check out for an unknown Job ID.");
            return;
        }

        const candidateId = loggedInCandidate.id;
        // Find the active record for this candidate and job on this date
        const recordToUpdate = candidateMyAttendanceData.find(record =>
            record.candidateId === candidateId &&
            record.jobId === jobId &&
            record.date === attendanceDate &&
            record.status === "Active"
        );
        if (recordToUpdate) {
            recordToUpdate.checkOut = checkOutTime;
            recordToUpdate.status = "Completed";
            // Update HR's data (simulated centralized data)
            const hrRecordToUpdate = hrAttendanceData.find(record =>
                record.candidateId === candidateId &&
                record.jobId === jobId &&
                record.date === attendanceDate &&
                record.workId === recordToUpdate.workId &&
                record.status === "Active"
            );
            if (hrRecordToUpdate) {
                hrRecordToUpdate.checkOut = checkOutTime;
                hrRecordToUpdate.status = "Completed";
            }

            // Add to candidate's payment history
            const job = postedJobs[jobId] || { salary: 100, hours: 1 }; // Fallback values
            const hoursWorked = calculateHours(recordToUpdate.checkIn, recordToUpdate.checkOut);
            const estimatedRatePerHour = job.salary / (job.hours || 1); // Calculate rate based on job or default
            const amountEarned = hoursWorked * estimatedRatePerHour;
            candidatePaymentHistoryData.push({
                candidateId: loggedInCandidate.id, // Ensure candidateId is stored
                workId: recordToUpdate.workId,
                jobId: recordToUpdate.jobId, // Add jobId to payment history
                jobRole: job.jobTitle || "Unknown Job",
                date: recordToUpdate.date,
                amount: amountEarned.toFixed(2),
                status: "Pending Payment"
            });
            populateCandidateAttendanceTable(); // Refresh candidate's table
            populateCandidateAttendanceForm(); // Reset form and pre-fill for next action
            alert(`Checked out for Job ID ${jobId} on ${attendanceDate} at ${checkOutTime}.\nWork ID: ${recordToUpdate.workId}`);
            // Record action in audit log
            adminAuditLogData.push({
                timestamp: getCurrentTimestampFormatted(),
                user: `${loggedInCandidate.id} (${loggedInCandidate.name})`,
                action: "Check-out",
                details: `Job ID: ${jobId}, Work ID: ${recordToUpdate.workId}`
            });
        } else {
            alert(`No active check-in found for Job ID ${jobId} on ${attendanceDate}. Please check in first.`);
        }
    }


    // Function to display candidate's payment history
    function showCandidatePaymentHistory() {
        // Hide the default attendance form and table in candidate dashboard
        document.getElementById('candidate-attendance-form-container').classList.add('hidden');
        document.getElementById('dashboard-candidate').querySelector('h3').classList.add('hidden');
        document.getElementById('candidate-attendance-body').parentNode.classList.add('hidden');

        const paymentHistoryBody = document.getElementById('candidate-payment-history-body');
        paymentHistoryBody.innerHTML = ''; // Clear previous data

        // Filter payments by logged-in candidate's ID
        const filteredPayments = candidatePaymentHistoryData.filter(
            payment => payment.candidateId === loggedInCandidate.id
        ).sort((a, b) => new Date(b.date) - new Date(a.date)); // Sort by date, most recent first


        if (filteredPayments.length > 0) {
            filteredPayments.forEach(payment => {
                const row = paymentHistoryBody.insertRow();
                row.insertCell(0).textContent = payment.workId;
                row.insertCell(1).textContent = payment.jobId || 'N/A'; // Display Job ID
                row.insertCell(2).textContent = payment.jobRole;
                row.insertCell(3).textContent = payment.date;
                row.insertCell(4).textContent = `Rs. ${payment.amount}`;
                row.insertCell(5).textContent = payment.status;
            });
        } else {
            const row = paymentHistoryBody.insertRow();
            const cell = row.insertCell(0);
            cell.colSpan = 6; // Adjusted colspan
            cell.textContent = "No payment history found.";
            cell.style.textAlign = "center";
            cell.style.fontStyle = "italic";
            cell.style.padding = "20px";
        }
        showSection('candidate-payment-history');
    }


    // Helper function to manage active state of Dashboard sub-nav buttons
    function setDashboardActiveTab(dashboardId, activeButtonId) {
        // Clear active class from all buttons in the specific dashboard's nav
        const buttons = document.querySelectorAll(`#${dashboardId} .dashboard-nav-buttons button`);
        buttons.forEach(btn => {
            btn.classList.remove('active');
        });
        // Set active class on the clicked button if provided
        if (activeButtonId) {
            document.getElementById(activeButtonId).classList.add('active');
        }

        // Manage visibility of content areas based on the active tab
        if (dashboardId === 'dashboard-candidate') {
            const isAttendanceView = !activeButtonId; // If no specific button is active, it's the default attendance view
            document.getElementById('candidate-attendance-form-container').classList.toggle('hidden', !isAttendanceView);
            document.getElementById('dashboard-candidate').querySelector('h3').classList.toggle('hidden', !isAttendanceView); // "My Attendance & Work IDs" heading
            document.getElementById('candidate-attendance-body').parentNode.classList.toggle('hidden', !isAttendanceView); // The attendance table itself
        }
        else if (dashboardId === 'dashboard-admin') {
            // Hide all admin overview sub-sections first
            document.getElementById('admin-manage-users').classList.add('hidden');
            document.getElementById('admin-add-user').classList.add('hidden');
            document.getElementById('admin-audit-logs').classList.add('hidden');
            document.getElementById('admin-hr-overview').classList.add('hidden');
            document.getElementById('admin-candidate-overview').classList.add('hidden');
            document.getElementById('admin-sales-overview').classList.add('hidden');
            document.getElementById('admin-finance-overview').classList.add('hidden');

            // Show the appropriate section based on activeButtonId or default to audit logs
            if (activeButtonId === 'admin-manage-users-btn') {
                document.getElementById('admin-manage-users').classList.remove('hidden');
            } else if (activeButtonId === 'admin-add-user-btn') {
                document.getElementById('admin-add-user').classList.remove('hidden');
            } else if (activeButtonId === 'admin-hr-overview-btn') {
                document.getElementById('admin-hr-overview').classList.remove('hidden');
            } else if (activeButtonId === 'admin-candidate-overview-btn') {
                document.getElementById('admin-candidate-overview').classList.remove('hidden');
            } else if (activeButtonId === 'admin-sales-overview-btn') {
                document.getElementById('admin-sales-overview').classList.remove('hidden');
            } else if (activeButtonId === 'admin-finance-overview-btn') {
                document.getElementById('admin-finance-overview').classList.remove('hidden');
            } else { // Default to audit logs if no specific button is active
                document.getElementById('admin-audit-logs').classList.remove('hidden');
                document.getElementById('admin-audit-logs-btn').classList.add('active');
            }
        }
        // For Sales Dashboard
        else if (dashboardId === 'dashboard-sales') {
            // Hide all sales sub-sections, including the new edit form
            document.getElementById('sales-clients-contracts-view').classList.add('hidden');
            document.getElementById('sales-reports-view').classList.add('hidden');
            document.getElementById('sales-add-client').classList.add('hidden');
            document.getElementById('sales-edit-client').classList.add('hidden');

            // Show the appropriate section based on activeButtonId or default to clients contracts
            if (activeButtonId === 'sales-clients-contracts-btn') {
                document.getElementById('sales-clients-contracts-view').classList.remove('hidden');
            } else if (activeButtonId === 'sales-reports-btn') {
                document.getElementById('sales-reports-view').classList.remove('hidden');
            } else if (activeButtonId === 'sales-add-client-btn') {
                document.getElementById('sales-add-client').classList.remove('hidden');
            } else if (activeButtonId === 'sales-edit-client') { // Handle showing edit form via section ID directly
                 document.getElementById('sales-edit-client').classList.remove('hidden');
            }
            else { // Default to clients and contracts view if no specific button active (e.g., after login)
                document.getElementById('sales-clients-contracts-view').classList.remove('hidden');
                document.getElementById('sales-clients-contracts-btn').classList.add('active');
            }
        }
        // For Finance Dashboard
        else if (dashboardId === 'dashboard-finance') {
            // Hide all finance sub-sections
            document.getElementById('finance-invoices-payments-view').classList.add('hidden');
            document.getElementById('finance-payroll-payouts-view').classList.add('hidden');
            document.getElementById('finance-reports-view').classList.add('hidden');

            // Show the appropriate section based on activeButtonId or default to invoices
            if (activeButtonId === 'finance-invoices-payments-btn') {
                document.getElementById('finance-invoices-payments-view').classList.remove('hidden');
            } else if (activeButtonId === 'finance-payroll-payouts-btn') {
                document.getElementById('finance-payroll-payouts-view').classList.remove('hidden');
            } else if (activeButtonId === 'finance-reports-btn') {
                document.getElementById('finance-reports-view').classList.remove('hidden');
            } else { // Default to invoices and payments view
                document.getElementById('finance-invoices-payments-view').classList.remove('hidden');
                document.getElementById('finance-invoices-payments-btn').classList.add('active');
            }
        }
    }


    // Admin Dashboard Functions

    function handleAddUser(event) {
        event.preventDefault();

        const username = document.getElementById('new-username').value;
        const password = document.getElementById('new-password').value;
        const role = document.getElementById('new-user-role').value;

        if (!username || !password || !role) {
            alert("Please fill in all fields (Username, Password, Role).");
            return;
        }

        const userExists = adminUsersData.some(user => user.username.toLowerCase() === username.toLowerCase());
        if (userExists) {
            alert(`User with username '${username}' already exists. Please choose a different username.`);
            return;
        }

        userIdCounter++;
        const newUserId = `${role.toUpperCase().substring(0,3)}-${String(userIdCounter).padStart(3, '0')}`;
        const newUser = {
            userId: newUserId,
            username: username,
            role: role,
            lastLogin: "Never",
            status: "Active"
        };
        adminUsersData.push(newUser);

        alert(`User '${username}' with role '${role}' (ID: ${newUserId}) added successfully!`);
        document.getElementById('form-add-user').reset();
        showSection('dashboard-admin');
        populateAdminAuditLogsTable();
        setDashboardActiveTab('dashboard-admin', 'admin-audit-logs-btn');

        adminAuditLogData.push({
            timestamp: getCurrentTimestampFormatted(),
            user: "admin@example.com",
            action: "Add New User",
            details: `User ID: ${newUserId}, Username: ${username}, Role: ${role}`
        });
    }

    function populateAdminUsersTable() {
        const usersBody = document.getElementById('admin-users-body');
        usersBody.innerHTML = '';

        if (adminUsersData.length > 0) {
            adminUsersData.forEach(user => {
                const row = usersBody.insertRow();
                row.insertCell(0).textContent = user.userId;
                row.insertCell(1).textContent = user.username;
                row.insertCell(2).textContent = user.role;
                row.insertCell(3).textContent = user.lastLogin;
                row.insertCell(4).textContent = user.status;
                const actionCell = row.insertCell(5);
                const toggleStatusBtn = document.createElement('button');
                toggleStatusBtn.textContent = user.status === 'Active' ? 'Deactivate' : 'Activate';
                toggleStatusBtn.className = user.status === 'Active' ? 'logout-btn' : '';
                toggleStatusBtn.style.padding = '5px 10px';
                toggleStatusBtn.style.marginBottom = '0';
                toggleStatusBtn.style.width = 'fit-content';
                toggleStatusBtn.onclick = () => {
                    const newStatus = user.status === 'Active' ? 'Inactive' : 'Active';
                    user.status = newStatus;
                    populateAdminUsersTable();
                    adminAuditLogData.push({
                        timestamp: getCurrentTimestampFormatted(),
                        user: "admin@example.com",
                        action: "User Status Change",
                        details: `User: ${user.username}, New Status: ${newStatus}`
                    });
                    alert(`User ${user.username} status toggled to ${newStatus}.`);
                };
                actionCell.appendChild(toggleStatusBtn);
            });
        } else {
            const row = usersBody.insertRow();
            const cell = row.insertCell(0);
            cell.colSpan = 6;
            cell.textContent = "No user data to display.";
            cell.style.textAlign = "center";
            cell.style.fontStyle = "italic";
            cell.style.padding = "20px";
        }
    }

    function populateAdminAuditLogsTable() {
        const auditLogsBody = document.getElementById('admin-audit-logs-body');
        auditLogsBody.innerHTML = '';

        const sortedLogs = [...adminAuditLogData].sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
        if (sortedLogs.length > 0) {
            sortedLogs.forEach(log => {
                const row = auditLogsBody.insertRow();
                row.insertCell(0).textContent = log.timestamp;
                row.insertCell(1).textContent = log.user;
                row.insertCell(2).textContent = log.action;
                row.insertCell(3).textContent = log.details;
            });
        } else {
            const row = auditLogsBody.insertRow();
            const cell = row.insertCell(0);
            cell.colSpan = 4;
            cell.textContent = "No audit logs to display.";
            cell.style.textAlign = "center";
            cell.style.fontStyle = "italic";
            cell.style.padding = "20px";
        }
    }

    function populateAdminHROverview() {
        const jobsSummaryBody = document.getElementById('admin-hr-jobs-summary-body');
        jobsSummaryBody.innerHTML = '';
        const applicantsSummaryBody = document.getElementById('admin-hr-applicants-summary-body');
        applicantsSummaryBody.innerHTML = '';

        const totalJobs = Object.keys(postedJobs).length;
        const activeJobs = Object.values(postedJobs).filter(job => job.status === 'Active').length;
        const closedJobs = Object.values(postedJobs).filter(job => job.status === 'Closed').length;

        let totalApplicants = 0;
        let interviewedApplicants = 0;
        let hiredApplicants = 0;
        Object.values(allJobApplicants).forEach(jobApps => {
            totalApplicants += jobApps.length;
            interviewedApplicants += jobApps.filter(app => app.status === 'Interview Scheduled' || app.status === 'Interviewed').length;
            hiredApplicants += jobApps.filter(app => app.status === 'Hired').length;
        });
        jobsSummaryBody.insertRow().insertCell(0).textContent = 'Total Jobs Posted';
        jobsSummaryBody.rows[0].insertCell(1).textContent = totalJobs;
        jobsSummaryBody.insertRow().insertCell(0).textContent = 'Active Jobs';
        jobsSummaryBody.rows[1].insertCell(1).textContent = activeJobs;
        jobsSummaryBody.insertRow().insertCell(0).textContent = 'Closed Jobs';
        jobsSummaryBody.rows[2].insertCell(1).textContent = closedJobs;

        applicantsSummaryBody.insertRow().insertCell(0).textContent = 'Total Applicants';
        applicantsSummaryBody.rows[0].insertCell(1).textContent = totalApplicants;
        applicantsSummaryBody.insertRow().insertCell(0).textContent = 'Interviewed/Scheduled';
        applicantsSummaryBody.rows[1].insertCell(1).textContent = interviewedApplicants;
        applicantsSummaryBody.insertRow().insertCell(0).textContent = 'Hired Applicants';
        applicantsSummaryBody.rows[2].insertCell(1).textContent = hiredApplicants;
    }

    function populateAdminCandidateOverview() {
        const candidateStatusBody = document.getElementById('admin-candidate-status-body');
        candidateStatusBody.innerHTML = '';
        const candidateApplicationsBody = document.getElementById('admin-candidate-applications-body');
        candidateApplicationsBody.innerHTML = '';
        const candidateAttendanceBody = document.getElementById('admin-candidate-attendance-body');
        candidateAttendanceBody.innerHTML = '';
        // Candidate Status Summary
        const totalCandidates = adminUsersData.filter(user => user.role === 'Candidate').length;
        const activeCandidates = adminUsersData.filter(user => user.role === 'Candidate' && user.status === 'Active').length;
        const inactiveCandidates = totalCandidates - activeCandidates;
        candidateStatusBody.insertRow().insertCell(0).textContent = 'Total Candidates';
        candidateStatusBody.rows[0].insertCell(1).textContent = totalCandidates;
        candidateStatusBody.insertRow().insertCell(0).textContent = 'Active Candidates';
        candidateStatusBody.rows[1].insertCell(1).textContent = activeCandidates;
        candidateStatusBody.insertRow().insertCell(0).textContent = 'Inactive Candidates';
        candidateStatusBody.rows[2].insertCell(1).textContent = inactiveCandidates;

        // Application Status Breakdown
        const applicationStatuses = {};
        candidateMyApplicationsData.forEach(app => {
            applicationStatuses[app.applicationStatus] = (applicationStatuses[app.applicationStatus] || 0) + 1;
        });
        for (const status in applicationStatuses) {
            const row = candidateApplicationsBody.insertRow();
            row.insertCell(0).textContent = status;
            row.insertCell(1).textContent = applicationStatuses[status];
        }

        // Attendance & Work Summary
        let totalShifts = hrAttendanceData.length;
        let completedShifts = hrAttendanceData.filter(rec => rec.status === 'Completed' || rec.status === 'Invoiced').length;
        let activeShifts = hrAttendanceData.filter(rec => rec.status === 'Active').length;
        let totalHoursWorked = 0;
        hrAttendanceData.forEach(rec => {
            if (rec.checkIn && rec.checkOut) {
                totalHoursWorked += calculateHours(rec.checkIn, rec.checkOut);
            }
        });
        candidateAttendanceBody.insertRow().insertCell(0).textContent = 'Total Shifts Recorded';
        candidateAttendanceBody.rows[0].insertCell(1).textContent = totalShifts;
        candidateAttendanceBody.insertRow().insertCell(0).textContent = 'Completed Shifts';
        candidateAttendanceBody.rows[1].insertCell(1).textContent = completedShifts;
        candidateAttendanceBody.insertRow().insertCell(0).textContent = 'Active Shifts';
        candidateAttendanceBody.rows[2].insertCell(1).textContent = activeShifts;
        candidateAttendanceBody.insertRow().insertCell(0).textContent = 'Total Hours Worked';
        candidateAttendanceBody.rows[3].insertCell(1).textContent = `${totalHoursWorked.toFixed(1)} hrs`;
    }

    function populateAdminSalesOverview() {
        const salesSummaryBody = document.getElementById('admin-sales-summary-body');
        salesSummaryBody.innerHTML = '';

        const totalClients = salesClientsData.length;
        let activeClients = salesClientsData.filter(client => client.status === 'Active').length;
        let prospectClients = salesClientsData.filter(client => client.status === 'Prospect').length;
        let totalContractValue = salesClientsData.reduce((sum, client) => sum + (client.contractValue || 0), 0);
        let activeContractValue = salesClientsData.filter(client => client.status === 'Active').reduce((sum, client) => sum + (client.contractValue || 0), 0);


        salesSummaryBody.insertRow().insertCell(0).textContent = 'Total Clients';
        salesSummaryBody.rows[0].insertCell(1).textContent = totalClients;
        salesSummaryBody.insertRow().insertCell(0).textContent = 'Active Clients';
        salesSummaryBody.rows[1].insertCell(1).textContent = activeClients;
        salesSummaryBody.insertRow().insertCell(0).textContent = 'Prospect Clients';
        salesSummaryBody.rows[2].insertCell(1).textContent = prospectClients;
        salesSummaryBody.insertRow().insertCell(0).textContent = 'Total Contract Value';
        salesSummaryBody.rows[3].insertCell(1).textContent = `Rs. ${totalContractValue.toLocaleString()}`;
        salesSummaryBody.insertRow().insertCell(0).textContent = 'Active Contract Value';
        salesSummaryBody.rows[4].insertCell(1).textContent = `Rs. ${activeContractValue.toLocaleString()}`;
    }

    function populateAdminFinanceOverview() {
        const financeSummaryBody = document.getElementById('admin-finance-summary-body');
        financeSummaryBody.innerHTML = '';
        const financePayrollBody = document.getElementById('admin-finance-payroll-body');
        financePayrollBody.innerHTML = '';

        let totalInvoiced = allInvoicesData.filter(inv => inv.type === 'Client').reduce((sum, inv) => sum + inv.amount, 0);
        let totalPaidInvoices = allInvoicesData.filter(inv => inv.type === 'Client' && inv.status === 'Paid').reduce((sum, inv) => sum + inv.amount, 0);
        let totalOutstandingInvoices = allInvoicesData.filter(inv => inv.type === 'Client' && inv.status !== 'Paid').reduce((sum, inv) => sum + inv.amount, 0);

        let totalWorkerPayoutsGenerated = allInvoicesData.filter(inv => inv.type === 'Worker Payout').reduce((sum, inv) => sum + inv.amount, 0);
        let totalPendingPayouts = financePayoutsData.filter(payout => payout.status !== 'Paid').reduce((sum, payout) => sum + payout.amount, 0);


        financeSummaryBody.insertRow().insertCell(0).textContent = 'Total Client Invoiced';
        financeSummaryBody.rows[0].insertCell(1).textContent = `Rs. ${totalInvoiced.toLocaleString()}`;
        financeSummaryBody.insertRow().insertCell(0).textContent = 'Paid Invoices';
        financeSummaryBody.rows[1].insertCell(1).textContent = `Rs. ${totalPaidInvoices.toLocaleString()}`;
        financeSummaryBody.insertRow().insertCell(0).textContent = 'Outstanding Invoices';
        financeSummaryBody.rows[2].insertCell(1).textContent = `Rs. ${totalOutstandingInvoices.toLocaleString()}`;


        financePayrollBody.insertRow().insertCell(0).textContent = 'Total Worker Payouts Generated';
        financePayrollBody.rows[0].insertCell(1).textContent = `Rs. ${totalWorkerPayoutsGenerated.toLocaleString()}`;
        financePayrollBody.insertRow().insertCell(0).textContent = 'Pending Worker Payouts';
        financePayrollBody.rows[1].insertCell(1).textContent = `Rs. ${totalPendingPayouts.toLocaleString()}`;
    }

    // Sales Dashboard Functions

    function populateSalesClientsTable() {
        const clientsBody = document.getElementById('sales-clients-contracts-body');
        clientsBody.innerHTML = '';

        if (salesClientsData.length > 0) {
            salesClientsData.forEach(client => {
                const row = clientsBody.insertRow();
                row.insertCell(0).textContent = client.clientId;
                row.insertCell(1).textContent = client.companyName;
                row.insertCell(2).textContent = client.contactPerson;
                row.insertCell(3).textContent = `Rs. ${client.contractValue.toLocaleString()}`;
                row.insertCell(4).textContent = client.renewalDate;
                row.insertCell(5).textContent = client.status;
                const actionCell = row.insertCell(6);
                const editButton = document.createElement('button');
                editButton.textContent = 'Edit';
                editButton.className = 'edit-btn';
                editButton.onclick = () => editClient(client.clientId);
                actionCell.appendChild(editButton);
            });
        } else {
            const row = clientsBody.insertRow();
            const cell = row.insertCell(0);
            cell.colSpan = 7;
            cell.textContent = "No clients or contracts to display.";
            cell.style.textAlign = "center";
            cell.style.fontStyle = "italic";
            cell.style.padding = "20px";
        }
        document.getElementById('sales-clients-contracts-view').classList.remove('hidden');
        document.getElementById('sales-reports-view').classList.add('hidden');
        document.getElementById('sales-add-client').classList.add('hidden');
        document.getElementById('sales-edit-client').classList.add('hidden');
    }

    function populateSalesReportsTable() {
        const reportsBody = document.getElementById('sales-reports-body');
        reportsBody.innerHTML = '';

        const sortedReports = [...salesReportsData].sort((a, b) => new Date(b.reportDate) - new Date(a.reportDate));

        if (sortedReports.length > 0) {
            sortedReports.forEach(report => {
                const row = reportsBody.insertRow();
                row.insertCell(0).textContent = report.reportId;
                row.insertCell(1).textContent = report.reportType;
                row.insertCell(2).textContent = report.reportDate;
                row.insertCell(3).textContent = `Rs. ${report.totalRevenue.toLocaleString()}`;
                row.insertCell(4).textContent = report.newLeads;
                row.insertCell(5).textContent = report.dealsClosed;
            });
        } else {
            const row = reportsBody.insertRow();
            const cell = row.insertCell(0);
            cell.colSpan = 6;
            cell.textContent = "No sales reports to display.";
            cell.style.textAlign = "center";
            cell.style.fontStyle = "italic";
            cell.style.padding = "20px";
        }
        document.getElementById('sales-reports-view').classList.remove('hidden');
        document.getElementById('sales-clients-contracts-view').classList.add('hidden');
        document.getElementById('sales-add-client').classList.add('hidden');
        document.getElementById('sales-edit-client').classList.add('hidden');
    }

    function showAddClientForm() {
        document.getElementById('form-add-client').reset();
        document.getElementById('sales-add-client').classList.remove('hidden');
        document.getElementById('sales-clients-contracts-view').classList.add('hidden');
        document.getElementById('sales-reports-view').classList.add('hidden');
        document.getElementById('sales-edit-client').classList.add('hidden');
    }

    function handleAddClient(event) {
        event.preventDefault();

        const companyName = document.getElementById('client-company-name').value;
        const gstNo = document.getElementById('client-gst-no').value;
        const companyAddress = document.getElementById('client-company-address').value;
        const employeeStrength = parseInt(document.getElementById('client-employee-strength').value, 10);
        const contactPerson = document.getElementById('client-contact-person').value;
        const contactEmail = document.getElementById('client-contact-email').value;
        const status = document.getElementById('client-status').value;

        if (!companyName || !companyAddress || !contactPerson || !contactEmail) {
            alert("Please fill in all required fields (Company Name, Address, Contact Person, Contact Email).");
            return;
        }

        clientIdCounter++;
        const newClientId = `CLI-${String(clientIdCounter).padStart(3, '0')}`;

        const newClient = {
            clientId: newClientId,
            companyName: companyName,
            gstNo: gstNo,
            companyAddress: companyAddress,
            employeeStrength: isNaN(employeeStrength) ? null : employeeStrength,
            contactPerson: contactPerson,
            contactEmail: contactEmail,
            contractValue: 0,
            renewalDate: "N/A",
            status: status,
            lastEngagement: getCurrentDateFormatted()
        };

        salesClientsData.push(newClient);
        populateClientCompanyDropdown(); // Refresh HR's client dropdown

        alert(`New client '${companyName}' (ID: ${newClientId}) added successfully!`);
        document.getElementById('form-add-client').reset();

        showSection('dashboard-sales');
        populateSalesClientsTable();
        setDashboardActiveTab('dashboard-sales', 'sales-clients-contracts-btn');

        adminAuditLogData.push({
            timestamp: getCurrentTimestampFormatted(),
            user: "sales@example.com",
            action: "Add New Client",
            details: `Client ID: ${newClientId}, Company: ${companyName}`
        });
    }

    function editClient(clientId) {
        const client = salesClientsData.find(c => c.clientId === clientId);
        if (!client) {
            alert("Client not found.");
            return;
        }

        document.getElementById('edit-client-id').value = client.clientId;
        document.getElementById('edit-client-company-name').value = client.companyName;
        document.getElementById('edit-client-gst-no').value = client.gstNo || '';
        document.getElementById('edit-client-company-address').value = client.companyAddress;
        document.getElementById('edit-client-employee-strength').value = client.employeeStrength || '';
        document.getElementById('edit-client-contact-person').value = client.contactPerson;
        document.getElementById('edit-client-contact-email').value = client.contactEmail;
        document.getElementById('edit-client-contract-value').value = client.contractValue || 0;
        document.getElementById('edit-client-renewal-date').value = client.renewalDate !== "N/A" ? client.renewalDate : '';
        document.getElementById('edit-client-status').value = client.status;

        showSection('sales-edit-client');
        setDashboardActiveTab('dashboard-sales', null);
    }

    function handleUpdateClient(event) {
        event.preventDefault();

        const clientId = document.getElementById('edit-client-id').value;
        const clientIndex = salesClientsData.findIndex(c => c.clientId === clientId);

        if (clientIndex === -1) {
            alert("Error: Client not found for update.");
            return;
        }

        const updatedClient = {
            clientId: clientId,
            companyName: document.getElementById('edit-client-company-name').value,
            gstNo: document.getElementById('edit-client-gst-no').value,
            companyAddress: document.getElementById('edit-client-company-address').value,
            employeeStrength: parseInt(document.getElementById('edit-client-employee-strength').value, 10),
            contactPerson: document.getElementById('edit-client-contact-person').value,
            contactEmail: document.getElementById('edit-client-contact-email').value,
            contractValue: parseFloat(document.getElementById('edit-client-contract-value').value),
            renewalDate: document.getElementById('edit-client-renewal-date').value || "N/A",
            status: document.getElementById('edit-client-status').value,
            lastEngagement: getCurrentDateFormatted()
        };

        salesClientsData[clientIndex] = updatedClient;
        populateClientCompanyDropdown(); // Refresh HR's client dropdown in case name changed

        alert(`Client '${updatedClient.companyName}' (ID: ${clientId}) updated successfully!`);

        showSection('dashboard-sales');
        populateSalesClientsTable();
        setDashboardActiveTab('dashboard-sales', 'sales-clients-contracts-btn');

        adminAuditLogData.push({
            timestamp: getCurrentTimestampFormatted(),
            user: "sales@example.com",
            action: "Update Client Details",
            details: `Client ID: ${clientId}, Company: ${updatedClient.companyName}`
        });
    }

    // Finance Dashboard Functions

    // Function to populate Finance Invoices & Payments table
    function populateFinanceInvoicesTable() {
        const invoicesBody = document.getElementById('finance-invoices-payments-body');
        invoicesBody.innerHTML = '';

        // Sort all invoices by date, most recent first
        const sortedInvoices = [...allInvoicesData].sort((a, b) => new Date(b.date) - new Date(a.date));

        if (sortedInvoices.length > 0) {
            sortedInvoices.forEach(invoice => {
                const row = invoicesBody.insertRow();
                row.insertCell(0).textContent = invoice.invoiceId;
                row.insertCell(1).textContent = invoice.clientWorker;
                row.insertCell(2).textContent = `Rs. ${invoice.amount.toLocaleString()}`;
                row.insertCell(3).textContent = invoice.date;
                row.insertCell(4).textContent = invoice.dueDate;
                row.insertCell(5).textContent = invoice.status;
                row.insertCell(6).textContent = invoice.type;
                const actionCell = row.insertCell(7);
                if (invoice.status === "Pending" && invoice.type === "Client") {
                    const markPaidBtn = document.createElement('button');
                    markPaidBtn.textContent = 'Mark Paid';
                    markPaidBtn.className = 'action-btn-finance green';
                    markPaidBtn.onclick = () => {
                        const confirmPay = confirm(`Mark Client Invoice ${invoice.invoiceId} as Paid?`);
                        if (confirmPay) {
                            invoice.status = 'Paid';
                            populateFinanceInvoicesTable(); // Refresh table
                            adminAuditLogData.push({ timestamp: getCurrentTimestampFormatted(), user: "finance@example.com", action: "Mark Invoice Paid", details: `Invoice ID: ${invoice.invoiceId}, Type: Client` });
                            alert(`Invoice ${invoice.invoiceId} marked as Paid.`);
                        }
                    };
                    actionCell.appendChild(markPaidBtn);
                } else if (invoice.status === "Generated" && invoice.type === "Worker Payout") {
                    const approvePayoutBtn = document.createElement('button');
                    approvePayoutBtn.textContent = 'Approve Payout';
                    approvePayoutBtn.className = 'action-btn-finance green';
                    approvePayoutBtn.onclick = () => {
                        const confirmPayout = confirm(`Approve Payout for Invoice ${invoice.invoiceId} (to ${invoice.clientWorker})?`);
                        if (confirmPayout) {
                            invoice.status = 'Approved';
                            // Mark corresponding individual payout records as paid/approved
                            const affectedPayouts = financePayoutsData.filter(payout => payout.workId === invoice.relatedId && payout.status === 'Pending'); // Match by workId
                            affectedPayouts.forEach(p => p.status = 'Paid');

                            populateFinanceInvoicesTable(); // Refresh invoice table
                            populateFinancePayrollTable(); // Refresh payroll table too
                            adminAuditLogData.push({ timestamp: getCurrentTimestampFormatted(), user: "finance@example.com", action: "Approve Worker Payout Invoice", details: `Invoice ID: ${invoice.invoiceId}, Type: Worker Payout` });
                            alert(`Payout Invoice ${invoice.invoiceId} Approved and related payouts marked Paid.`);
                        }
                    };
                    actionCell.appendChild(approvePayoutBtn);
                } else {
                    actionCell.textContent = "N/A";
                }
            });
        } else {
            const row = invoicesBody.insertRow();
            const cell = row.insertCell(0);
            cell.colSpan = 8;
            cell.textContent = "No invoices or payments to display.";
            cell.style.textAlign = "center";
            cell.style.fontStyle = "italic";
            cell.style.padding = "20px";
        }
        // Ensure the correct view is shown and others are hidden
        document.getElementById('finance-invoices-payments-view').classList.remove('hidden');
        document.getElementById('finance-payroll-payouts-view').classList.add('hidden');
        document.getElementById('finance-reports-view').classList.add('hidden');
    }

    // Function to populate Finance Payroll & Payouts table
    function populateFinancePayrollTable() {
        const payrollBody = document.getElementById('finance-payroll-payouts-body');
        payrollBody.innerHTML = '';

        const sortedPayouts = [...financePayoutsData].sort((a, b) => new Date(b.date) - new Date(a.date));

        if (sortedPayouts.length > 0) {
            sortedPayouts.forEach(payout => {
                const row = payrollBody.insertRow();
                row.insertCell(0).textContent = payout.payoutId;
                row.insertCell(1).textContent = payout.payee;
                row.insertCell(2).textContent = payout.workId; // Work ID
                row.insertCell(3).textContent = payout.slotTime; // Slot Time
                row.insertCell(4).textContent = payout.company; // Company
                row.insertCell(5).textContent = payout.date;
                row.insertCell(6).textContent = payout.checkIn; // Check-in
                row.insertCell(7).textContent = payout.checkOut; // Check-out
                row.insertCell(8).textContent = `Rs. ${payout.amount.toLocaleString()}`;
                row.insertCell(9).textContent = payout.status;
                const actionCell = row.insertCell(10);

                if (payout.status === "Pending") {
                    const processPaymentBtn = document.createElement('button');
                    processPaymentBtn.textContent = 'Process Payment';
                    processPaymentBtn.className = 'action-btn-finance green';
                    processPaymentBtn.onclick = () => {
                        const confirmProcess = confirm(`Process payment for ${payout.payee} (Work ID: ${payout.workId}, Rs. ${payout.amount})?`);
                        if (confirmProcess) {
                            payout.status = 'Paid';
                            // Also mark the corresponding invoice in allInvoicesData as Paid if it exists and is not already.
                            // This depends on how individual payouts relate to aggregated invoices.
                            // For simplicity, we assume approving the payout here means the individual record is settled.
                            populateFinancePayrollTable(); // Refresh table
                            adminAuditLogData.push({ timestamp: getCurrentTimestampFormatted(), user: "finance@example.com", action: "Process Payout", details: `Payout ID: ${payout.payoutId}, Payee: ${payout.payee}, Work ID: ${payout.workId}` });
                            alert(`Payment for ${payout.payee} (Work ID: ${payout.workId}) processed.`);
                        }
                    };
                    actionCell.appendChild(processPaymentBtn);
                } else {
                    actionCell.textContent = "N/A";
                }
            });
        } else {
            const row = payrollBody.insertRow();
            const cell = row.insertCell(0);
            cell.colSpan = 11; // Updated colspan for new columns
            cell.textContent = "No payroll or payouts to display.";
            cell.style.textAlign = "center";
            cell.style.fontStyle = "italic";
            cell.style.padding = "20px";
        }
        document.getElementById('finance-payroll-payouts-view').classList.remove('hidden');
        document.getElementById('finance-invoices-payments-view').classList.add('hidden');
        document.getElementById('finance-reports-view').classList.add('hidden');
    }

    // Function to populate Finance Reports table (already has static data in HTML for demo)
    function populateFinanceReportsTable() {
        // This function would typically fetch and calculate dynamic data.
        // For this demo, the table body is pre-populated with static values.
        // You would update the <tbody> with dynamic rows here in a real app.

        document.getElementById('finance-reports-view').classList.remove('hidden');
        document.getElementById('finance-invoices-payments-view').classList.add('hidden');
        document.getElementById('finance-payroll-payouts-view').classList.add('hidden');
    }


    // --- Event Listeners Initialization ---
    document.addEventListener('DOMContentLoaded', () => {
        // Set default date for attendance forms to today
        document.getElementById('attendance-date').value = getCurrentDateFormatted();
        document.getElementById('candidate-attendance-date').value = getCurrentDateFormatted();


        // Attach click listeners to navigation tabs (for login roles)
        document.querySelectorAll('#nav-login-tabs button').forEach(button => {
            button.addEventListener('click', () => {
                showSection(button.dataset.target);
            });
        });

        // Attach submit listeners to login forms
        document.querySelectorAll('form[id^="form-"]').forEach(form => {
            form.addEventListener('submit', handleLogin);
        });

        // Attach click listeners to all logout buttons
        document.querySelectorAll('.logout-btn').forEach(button => {
            button.addEventListener('click', logout);
        });

        // HR Dashboard Actions
        document.getElementById('post-job-btn').addEventListener('click', showPostJobForm);
        document.getElementById('manage-slots-btn').addEventListener('click', showSlotsAssignments);
        document.getElementById('view-invoices-btn').addEventListener('click', showInvoicesPayments);
        document.getElementById('manage-attendance-btn').addEventListener('click', () => {
            populateAttendanceTable();
            document.getElementById('attendance-date').value = getCurrentDateFormatted();
            document.getElementById('check-in-time').value = getCurrentTimeFormatted();
            document.getElementById('check-out-time').value = '';

            showSection('hr-attendance-invoicing');
        });

        // Post New Job Form Actions (HR)
        document.getElementById('form-post-job').addEventListener('submit', handlePostJob);
        document.getElementById('cancel-post-job').addEventListener('click', () => {
            document.getElementById('form-post-job').reset();
            showSection('dashboard-hr');
        });

        // Applicants List Actions (HR)
        document.getElementById('back-to-hr-dashboard-from-applicants').addEventListener('click', () => {
            showSection('dashboard-hr');
        });
        document.querySelector('#job-postings-table tbody').addEventListener('click', (event) => {
            if (event.target.classList.contains('applicant-count')) {
                const jobId = event.target.dataset.jobId;
                showApplicantsList(jobId);
            }
        });

        // Slots & Assignments Actions (HR)
        document.getElementById('back-to-hr-dashboard-from-slots').addEventListener('click', () => {
            showSection('dashboard-hr');
        });

        // Invoices & Payments Actions (HR)
        document.getElementById('back-to-hr-dashboard-from-invoices').addEventListener('click', () => {
            showSection('dashboard-hr');
        });

        // Attendance & Invoicing Actions (HR)
        document.getElementById('mark-check-in-btn').addEventListener('click', handleCheckIn);
        document.getElementById('mark-check-out-btn').addEventListener('click', handleCheckOut);
        document.getElementById('generate-invoice-btn').addEventListener('click', generateInvoiceForSelected);
        document.getElementById('back-to-hr-dashboard-from-attendance').addEventListener('click', () => {
            showSection('dashboard-hr');
        });

        // Candidate Dashboard Nav Buttons (within dashboard-candidate section)
        document.getElementById('view-available-jobs-cand-btn').addEventListener('click', () => {
            showAvailableSlots();
            setDashboardActiveTab('dashboard-candidate', 'view-available-jobs-cand-btn');
        });

        document.getElementById('my-applications-cand-btn').addEventListener('click', () => {
            showMyApplications();
            setDashboardActiveTab('dashboard-candidate', 'my-applications-cand-btn');
        });

        // Payment History Actions (Candidate)
        document.getElementById('payment-history-cand-btn').addEventListener('click', () => {
            showCandidatePaymentHistory();
            setDashboardActiveTab('dashboard-candidate', 'payment-history-cand-btn');
        });


        // Back buttons from Candidate sub-sections
        document.getElementById('back-to-candidate-dashboard-from-available-slots').addEventListener('click', () => {
            showSection('dashboard-candidate');
            populateCandidateAttendanceTable();
            populateCandidateAttendanceForm();
            setDashboardActiveTab('dashboard-candidate', null);
        });

        document.getElementById('back-to-candidate-dashboard-from-applications').addEventListener('click', () => {
            showSection('dashboard-candidate');
            populateCandidateAttendanceTable();
            populateCandidateAttendanceForm();
            setDashboardActiveTab('dashboard-candidate', null);
        });

        document.getElementById('back-to-candidate-dashboard-from-payment-history').addEventListener('click', () => {
            showSection('dashboard-candidate');
            populateCandidateAttendanceTable();
            populateCandidateAttendanceForm();
            setDashboardActiveTab('dashboard-candidate', null);
        });

        // Candidate Self-Service Attendance Buttons
        document.getElementById('candidate-mark-check-in-btn').addEventListener('click', handleCandidateCheckIn);
        document.getElementById('candidate-mark-check-out-btn').addEventListener('click', handleCandidateCheckOut);


        // Admin Dashboard Actions
        document.getElementById('admin-manage-users-btn').addEventListener('click', () => {
            populateAdminUsersTable();
            setDashboardActiveTab('dashboard-admin', 'admin-manage-users-btn');
            showSection('admin-manage-users');
        });
        document.getElementById('admin-add-user-btn').addEventListener('click', () => {
            document.getElementById('form-add-user').reset();
            setDashboardActiveTab('dashboard-admin', 'admin-add-user-btn');
            showSection('admin-add-user');
        });

        document.getElementById('admin-audit-logs-btn').addEventListener('click', () => {
            populateAdminAuditLogsTable();
            setDashboardActiveTab('dashboard-admin', 'admin-audit-logs-btn');
        });
        document.getElementById('admin-hr-overview-btn').addEventListener('click', () => {
            populateAdminHROverview();
            setDashboardActiveTab('dashboard-admin', 'admin-hr-overview-btn');
            showSection('admin-hr-overview');
        });
        document.getElementById('admin-candidate-overview-btn').addEventListener('click', () => {
            populateAdminCandidateOverview();
            setDashboardActiveTab('dashboard-admin', 'admin-candidate-overview-btn');
            showSection('admin-candidate-overview');
        });
        document.getElementById('admin-sales-overview-btn').addEventListener('click', () => {
            populateAdminSalesOverview();
            setDashboardActiveTab('dashboard-admin', 'admin-sales-overview-btn');
            showSection('admin-sales-overview');
        });
        document.getElementById('admin-finance-overview-btn').addEventListener('click', () => {
            populateAdminFinanceOverview();
            setDashboardActiveTab('dashboard-admin', 'admin-finance-overview-btn');
            showSection('admin-finance-overview');
        });


        // Back buttons from Admin sub-sections
        document.getElementById('back-to-admin-dashboard-from-users').addEventListener('click', () => {
            showSection('dashboard-admin');
            populateAdminAuditLogsTable();
            setDashboardActiveTab('dashboard-admin', 'admin-audit-logs-btn');
        });
        document.getElementById('cancel-add-user').addEventListener('click', () => {
            document.getElementById('form-add-user').reset();
            showSection('dashboard-admin');
            populateAdminAuditLogsTable();
            setDashboardActiveTab('dashboard-admin', 'admin-audit-logs-btn');
        });

        document.getElementById('back-to-admin-dashboard-from-audit-logs').addEventListener('click', () => {
            showSection('dashboard-admin');
            populateAdminAuditLogsTable();
            setDashboardActiveTab('dashboard-admin', 'admin-audit-logs-btn');
        });
        document.getElementById('back-to-admin-dashboard-from-hr-overview').addEventListener('click', () => {
            showSection('dashboard-admin');
            populateAdminAuditLogsTable();
            setDashboardActiveTab('dashboard-admin', 'admin-audit-logs-btn');
        });
        document.getElementById('back-to-admin-dashboard-from-candidate-overview').addEventListener('click', () => {
            showSection('dashboard-admin');
            populateAdminAuditLogsTable();
            setDashboardActiveTab('dashboard-admin', 'admin-audit-logs-btn');
        });
        document.getElementById('back-to-admin-dashboard-from-sales-overview').addEventListener('click', () => {
            showSection('dashboard-admin');
            populateAdminAuditLogsTable();
            setDashboardActiveTab('dashboard-admin', 'admin-audit-logs-btn');
        });
        document.getElementById('back-to-admin-dashboard-from-finance-overview').addEventListener('click', () => {
            showSection('dashboard-admin');
            populateAdminAuditLogsTable();
            setDashboardActiveTab('dashboard-admin', 'admin-audit-logs-btn');
        });

        document.getElementById('form-add-user').addEventListener('submit', handleAddUser);

        // Sales Dashboard Sub-navigation Buttons
        document.getElementById('sales-clients-contracts-btn').addEventListener('click', () => {
            populateSalesClientsTable();
            setDashboardActiveTab('dashboard-sales', 'sales-clients-contracts-btn');
        });
        document.getElementById('sales-reports-btn').addEventListener('click', () => {
            populateSalesReportsTable();
            setDashboardActiveTab('dashboard-sales', 'sales-reports-btn');
        });
        document.getElementById('sales-add-client-btn').addEventListener('click', () => {
            showAddClientForm();
            setDashboardActiveTab('dashboard-sales', 'sales-add-client-btn');
        });

        // Sales Add Client Form Actions
        document.getElementById('form-add-client').addEventListener('submit', handleAddClient);
        document.getElementById('cancel-add-client').addEventListener('click', () => {
            document.getElementById('form-add-client').reset();
            showSection('dashboard-sales');
            populateSalesClientsTable();
            setDashboardActiveTab('dashboard-sales', 'sales-clients-contracts-btn');
        });

        // Sales Edit Client Form Actions
        document.getElementById('form-edit-client').addEventListener('submit', handleUpdateClient);
        document.getElementById('cancel-edit-client').addEventListener('click', () => {
            document.getElementById('form-edit-client').reset();
            showSection('dashboard-sales');
            populateSalesClientsTable();
            setDashboardActiveTab('dashboard-sales', 'sales-clients-contracts-btn');
        });

        // Finance Dashboard Sub-navigation Buttons
        document.getElementById('finance-invoices-payments-btn').addEventListener('click', () => {
            populateFinanceInvoicesTable();
            setDashboardActiveTab('dashboard-finance', 'finance-invoices-payments-btn');
        });
        document.getElementById('finance-payroll-payouts-btn').addEventListener('click', () => {
            populateFinancePayrollTable();
            setDashboardActiveTab('dashboard-finance', 'finance-payroll-payouts-btn');
        });
        document.getElementById('finance-reports-btn').addEventListener('click', () => {
            populateFinanceReportsTable();
            setDashboardActiveTab('dashboard-finance', 'finance-reports-btn');
        });

        // Initial setup logic
        showSection('login-hr');
    });
</script>

</body>
</html>
